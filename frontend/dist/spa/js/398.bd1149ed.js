"use strict";(globalThis["webpackChunkchinese_sub_finder_panel"]=globalThis["webpackChunkchinese_sub_finder_panel"]||[]).push([[398],{6398:(e,a,l)=>{l.r(a),l.d(a,{default:()=>se});var s=l(3673),t=(l(3610),l(5663),l(2323)),o=l(1959),i=l(9608),n=l(7493),r=l(9897),u=l(8423),m=l(4739),d=l(1684),p=l(3280);const _={class:"q-pa-md"},c={class:"relative-position"},v=(0,s._)("div",{class:"text-bold"},"1. 确认视频信息",-1),f={class:"q-mt-md"},h=(0,s._)("div",{class:"text-bold"},"2. 确认 SubtitleBest 中该视频已存在的字幕",-1),w={class:"relative-position q-card--bordered",style:{height:"320px",overflow:"auto"}},g={class:"q-mt-md"},k=(0,s._)("div",{class:"text-bold"},"3. 选择要上传的字幕",-1),y={class:"row items-center q-gutter-xs"},b={class:"q-mt-md"},S=(0,s._)("div",{class:"text-bold"},"4. 填写字幕上传信息",-1),T={class:"row items-center"},W=(0,s._)("div",{style:{width:"120px"}},"这是机翻吗？",-1),U={class:"q-gutter-sm"},G={class:"row items-center"},q=(0,s._)("div",{style:{width:"120px"}},"字幕质量如何？",-1),B={class:"q-gutter-sm"},V={class:"q-mt-sm"},I={class:"q-mt-sm"},Z={class:"q-mt-md row items-center q-gutter-md"},E={key:0,class:"text-negative"},D={__name:"ShareSubtitlePanel",props:{isMovie:{type:Boolean,default:!1},mediaData:{type:Object}},setup(e){const a=e,l=(0,o.iH)(null),D=(0,o.iH)(!1),C=(0,o.iH)(!1),j=(0,o.iH)(0),x=(0,o.iH)(!1),M=(0,o.qj)({markType:null,ratting:null,confirmMatch:!1,confirmBetter:!1}),Q=(0,s.Fl)((()=>!M.markType||!M.ratting||[1,2].includes(M.ratting)||!M.confirmMatch||x.value&&!M.confirmBetter)),z=()=>{if(a.isMovie){const e=a.mediaData?.sub_url_list.map(((e,l)=>({name:e.split(/[/\\]/).pop(),path:a.mediaData.video_f_path,subUrl:e,subPath:a.mediaData.sub_f_path_list[l]})));return[{selected:e[0],list:e}]}const e=a.mediaData.map((e=>{const a=e.sub_url_list.map(((a,l)=>({name:a.split(/[/\\]/).pop(),path:e.video_f_path,subUrl:a,subPath:e.sub_f_path_list[l]})));return{episode:e.episode,video_f_path:e.video_f_path,selected:a[0],list:a}})).sort(((e,a)=>e.episode-a.episode));return e},L=(0,o.qj)(z()),H=async()=>{D.value=!0;const e=a.isMovie?a.mediaData.video_f_path:a.mediaData[0].video_f_path,[s,t]=await n.Z.getImdbId({video_f_path:e,is_movie:a.isMovie});D.value=!1,t?r.j.error(t.message):l.value=s},P=e=>{x.value=e?.length>0},Y=async()=>{C.value=!0,j.value=0;const e=[];for(let l=0;l<L.length;l+=1){const s=L[l],[t,o]=await n.Z.getUploadInfo({is_movie:a.isMovie,video_f_path:a.isMovie?a.mediaData.video_f_path:s.video_f_path,sub_f_path:s.selected.subPath,season:a.mediaData?.[0]?.season,episode:s.episode});if(null!==o)return r.j.error(o.message),void(C.value=!1);const[i,u]=await d.Z.getUploadUrl({...t,score:M.ratting,mark_type:M.markType});if(null!==u)return r.j.error(u.message),void(C.value=!1);const{subUrl:p}=s.selected,_=await fetch((0,m.Gr)(p)),c=await _.blob(),v=new File([c],p.split(/[/\\]/).pop(),{type:"text/plain"});await fetch(i.upload_url,{method:"PUT",body:v});const[f,h]=await d.Z.setUploadSuccess({token:i.token});if(null!==h)return r.j.error(h.message),void(C.value=!1);e.push(f.token),j.value+=1}if(!a.isMovie){const[,a]=await d.Z.setUploadSuccessForTv({tokens:e});if(null!==a)return r.j.error(a.message),void(C.value=!1)}C.value=!1,r.j.success("上传成功")};return(0,s.bv)((()=>{H()})),(a,n)=>{const r=(0,s.up)("q-td"),m=(0,s.up)("q-tr"),d=(0,s.up)("q-markup-table"),z=(0,s.up)("q-inner-loading"),H=(0,s.up)("q-spinner"),F=(0,s.up)("q-icon"),O=(0,s.up)("q-item-section"),R=(0,s.up)("q-select"),K=(0,s.up)("q-item"),A=(0,s.up)("q-list"),J=(0,s.up)("q-radio"),N=(0,s.up)("q-checkbox"),X=(0,s.up)("q-separator"),$=(0,s.up)("q-btn");return(0,s.wg)(),(0,s.iD)("div",_,[(0,s._)("section",c,[v,(0,s.Wm)(d,{flat:"",dense:""},{default:(0,s.w5)((()=>[(0,s.Wm)(m,null,{default:(0,s.w5)((()=>[(0,s.Wm)(r,{style:{width:"150px"}},{default:(0,s.w5)((()=>[(0,s.Uk)("IMDB ID")])),_:1}),(0,s.Wm)(r,null,{default:(0,s.w5)((()=>[(0,s.Uk)((0,t.zw)(l.value?.ImdbId),1)])),_:1})])),_:1}),(0,s.Wm)(m,null,{default:(0,s.w5)((()=>[(0,s.Wm)(r,null,{default:(0,s.w5)((()=>[(0,s.Uk)("TMDB ID")])),_:1}),(0,s.Wm)(r,null,{default:(0,s.w5)((()=>[(0,s.Uk)((0,t.zw)(l.value?.TmdbId),1)])),_:1})])),_:1}),(0,s.Wm)(m,null,{default:(0,s.w5)((()=>[(0,s.Wm)(r,null,{default:(0,s.w5)((()=>[(0,s.Uk)("原始语言")])),_:1}),(0,s.Wm)(r,null,{default:(0,s.w5)((()=>[(0,s.Uk)((0,t.zw)(l.value?.OriginalLanguage),1)])),_:1})])),_:1}),(0,s.Wm)(m,null,{default:(0,s.w5)((()=>[(0,s.Wm)(r,null,{default:(0,s.w5)((()=>[(0,s.Uk)("原始标题")])),_:1}),(0,s.Wm)(r,null,{default:(0,s.w5)((()=>[(0,s.Uk)((0,t.zw)(l.value?.OriginalTitle),1)])),_:1})])),_:1}),(0,s.Wm)(m,null,{default:(0,s.w5)((()=>[(0,s.Wm)(r,null,{default:(0,s.w5)((()=>[(0,s.Uk)("中文标题")])),_:1}),(0,s.Wm)(r,null,{default:(0,s.w5)((()=>[(0,s.Uk)((0,t.zw)(l.value?.TitleCn),1)])),_:1})])),_:1}),(0,s.Wm)(m,null,{default:(0,s.w5)((()=>[(0,s.Wm)(r,null,{default:(0,s.w5)((()=>[(0,s.Uk)("季")])),_:1}),(0,s.Wm)(r,null,{default:(0,s.w5)((()=>[(0,s.Uk)("第"+(0,t.zw)(e.mediaData?.[0]?.season)+"季",1)])),_:1})])),_:1}),(0,s.Wm)(m,null,{default:(0,s.w5)((()=>[(0,s.Wm)(r,null,{default:(0,s.w5)((()=>[(0,s.Uk)("英文标题")])),_:1}),(0,s.Wm)(r,null,{default:(0,s.w5)((()=>[(0,s.Uk)((0,t.zw)(l.value?.TitleEn),1)])),_:1})])),_:1}),(0,s.Wm)(m,null,{default:(0,s.w5)((()=>[(0,s.Wm)(r,null,{default:(0,s.w5)((()=>[(0,s.Uk)("年份")])),_:1}),(0,s.Wm)(r,null,{default:(0,s.w5)((()=>[(0,s.Uk)((0,t.zw)(l.value?.Year),1)])),_:1})])),_:1})])),_:1}),(0,s.Wm)(z,{showing:D.value},null,8,["showing"])]),(0,s._)("section",f,[h,(0,s._)("div",w,[e.isMovie?((0,s.wg)(),(0,s.j4)(u.Z,{key:0,"is-movie":"",path:e.mediaData.video_f_path,"hide-download":"","hide-limit":"",onGetResult:P},null,8,["path"])):((0,s.wg)(),(0,s.j4)(p.Z,{key:1,episodes:e.mediaData,"hide-download":"","hide-limit":"",onGetResult:P},null,8,["episodes"]))])]),(0,s._)("section",g,[k,(0,s.Wm)(A,{style:{"max-height":"600px"}},{default:(0,s.w5)((()=>[((0,s.wg)(!0),(0,s.iD)(s.HY,null,(0,s.Ko)(L,((a,l)=>((0,s.wg)(),(0,s.j4)(K,{key:l},{default:(0,s.w5)((()=>[e.isMovie?(0,s.kq)("",!0):((0,s.wg)(),(0,s.j4)(O,{key:0,side:"",style:{width:"80px"}},{default:(0,s.w5)((()=>[(0,s._)("div",y,[C.value&&l===j.value?((0,s.wg)(),(0,s.j4)(H,{key:0})):(0,s.kq)("",!0),j.value>l?((0,s.wg)(),(0,s.j4)(F,{key:1,name:"check_circle",color:"positive",title:"上传完成"})):(0,s.kq)("",!0),(0,s._)("div",null,"第"+(0,t.zw)(a.episode)+"集",1)])])),_:2},1024)),(0,s.Wm)(O,null,{default:(0,s.w5)((()=>[(0,s.Wm)(R,{modelValue:a.selected,"onUpdate:modelValue":e=>a.selected=e,options:a.list,"option-label":"name","option-value":"id",filled:"",dense:""},null,8,["modelValue","onUpdate:modelValue","options"])])),_:2},1024),(0,s.Wm)(O,{side:""},{default:(0,s.w5)((()=>[(0,s.Wm)(i.Z,{size:"sm","subtitle-url-list":[a.selected.subUrl],path:a.selected.path},null,8,["subtitle-url-list","path"])])),_:2},1024)])),_:2},1024)))),128))])),_:1})]),(0,s._)("section",b,[S,(0,s._)("div",T,[W,(0,s._)("div",U,[(0,s.Wm)(J,{modelValue:M.markType,"onUpdate:modelValue":n[0]||(n[0]=e=>M.markType=e),val:2,label:"是"},null,8,["modelValue"]),(0,s.Wm)(J,{modelValue:M.markType,"onUpdate:modelValue":n[1]||(n[1]=e=>M.markType=e),val:1,label:"否"},null,8,["modelValue"])])]),(0,s._)("div",G,[q,(0,s._)("div",B,[(0,s.Wm)(J,{modelValue:M.ratting,"onUpdate:modelValue":n[2]||(n[2]=e=>M.ratting=e),val:1,label:"不匹配"},null,8,["modelValue"]),(0,s.Wm)(J,{modelValue:M.ratting,"onUpdate:modelValue":n[3]||(n[3]=e=>M.ratting=e),val:2,label:"差"},null,8,["modelValue"]),(0,s.Wm)(J,{modelValue:M.ratting,"onUpdate:modelValue":n[4]||(n[4]=e=>M.ratting=e),val:3,label:"一般"},null,8,["modelValue"]),(0,s.Wm)(J,{modelValue:M.ratting,"onUpdate:modelValue":n[5]||(n[5]=e=>M.ratting=e),val:4,label:"好"},null,8,["modelValue"])])]),(0,s._)("div",V,[(0,s.Wm)(N,{modelValue:M.confirmMatch,"onUpdate:modelValue":n[6]||(n[6]=e=>M.confirmMatch=e),dense:"",label:"我确认上传的字幕和视频匹配"},null,8,["modelValue"])]),(0,s._)("div",I,[x.value?((0,s.wg)(),(0,s.j4)(N,{key:0,modelValue:M.confirmBetter,"onUpdate:modelValue":n[7]||(n[7]=e=>M.confirmBetter=e),dense:"",label:"我确认上传的字幕比 SubtitleBest 上已有的字幕更好"},null,8,["modelValue"])):(0,s.kq)("",!0)])]),(0,s.Wm)(X,{class:"q-my-md"}),(0,s._)("section",null,[(0,s._)("div",Z,[(0,s.Wm)($,{color:"primary",label:"提交",disable:(0,o.SU)(Q),loading:C.value,onClick:Y},null,8,["disable","loading"]),(0,o.SU)(Q)?((0,s.wg)(),(0,s.iD)("div",E,[1===M.ratting||2===M.ratting?((0,s.wg)(),(0,s.iD)(s.HY,{key:0},[(0,s.Uk)(' 不能上传字幕质量为"不匹配"或者"差"的字幕 ')],64)):((0,s.wg)(),(0,s.iD)(s.HY,{key:1},[(0,s.Uk)("请完善表单")],64))])):(0,s.kq)("",!0)])])])}}};var C=l(481),j=l(8186),x=l(3884),M=l(6941),Q=l(151),z=l(7011),L=l(3414),H=l(2035),P=l(9400),Y=l(4554),F=l(8516),O=l(7991),R=l(5735),K=l(5869),A=l(2165),J=l(7518),N=l.n(J);const X=D,$=X;N()(D,"components",{QMarkupTable:C.Z,QTr:j.Z,QTd:x.Z,QInnerLoading:M.Z,QCard:Q.Z,QList:z.Z,QItem:L.Z,QItemSection:H.Z,QSpinner:P.Z,QIcon:Y.Z,QSelect:F.Z,QRadio:O.Z,QCheckbox:R.Z,QSeparator:K.Z,QBtn:A.Z});var ee=l(9238);const ae={__name:"ShareSubtitlePanel.test",setup(e){const a=!1,l=[{name:"Game of Thrones - S01E01 - Winter Is Coming Bluray-1080p.mkv",video_f_path:"/Users/myon/temp/cctv/Game of Thrones/Season 1/Game of Thrones - S01E01 - Winter Is Coming Bluray-1080p.mkv",video_url:"/series_dir_0/Game of Thrones/Season 1/Game of Thrones - S01E01 - Winter Is Coming Bluray-1080p.mkv",season:1,episode:1,sub_f_path_list:["/Users/myon/temp/cctv/Game of Thrones/Season 1/Game of Thrones - S01E01 - Winter Is Coming Bluray-1080p.ass","/Users/myon/temp/cctv/Game of Thrones/Season 1/Game of Thrones - S01E01 - Winter Is Coming Bluray-1080p.srt"],sub_url_list:["/series_dir_0/Game of Thrones/Season 1/Game of Thrones - S01E01 - Winter Is Coming Bluray-1080p.ass","/series_dir_0/Game of Thrones/Season 1/Game of Thrones - S01E01 - Winter Is Coming Bluray-1080p.srt"],media_server_inside_video_id:""},{name:"Game of Thrones - S01E02 - Winter Is Coming Bluray-1080p.mkv",video_f_path:"/Users/myon/temp/cctv/Game of Thrones/Season 1/Game of Thrones - S01E02 - Winter Is Coming Bluray-1080p.mkv",video_url:"/series_dir_0/Game of Thrones/Season 1/Game of Thrones - S01E02 - Winter Is Coming Bluray-1080p.mkv",season:1,episode:2,sub_f_path_list:["/Users/myon/temp/cctv/Game of Thrones/Season 1/Game of Thrones - S01E02 - Winter Is Coming Bluray-1080p.ass","/Users/myon/temp/cctv/Game of Thrones/Season 1/Game of Thrones - S01E02 - Winter Is Coming Bluray-1080p.srt"],sub_url_list:["/series_dir_0/Game of Thrones/Season 1/Game of Thrones - S01E02 - Winter Is Coming Bluray-1080p.ass","/series_dir_0/Game of Thrones/Season 1/Game of Thrones - S01E02 - Winter Is Coming Bluray-1080p.srt"],media_server_inside_video_id:""},{name:"Game of Thrones - S01E03 - Lord Snow Bluray-1080p.mkv",video_f_path:"/Users/myon/temp/cctv/Game of Thrones/Season 1/Game of Thrones - S01E03 - Lord Snow Bluray-1080p.mkv",video_url:"/series_dir_0/Game of Thrones/Season 1/Game of Thrones - S01E03 - Lord Snow Bluray-1080p.mkv",season:1,episode:3,sub_f_path_list:["/Users/myon/temp/cctv/Game of Thrones/Season 1/Game of Thrones - S01E03 - Lord Snow Bluray-1080p.ass","/Users/myon/temp/cctv/Game of Thrones/Season 1/Game of Thrones - S01E03 - Lord Snow Bluray-1080p.srt"],sub_url_list:["/series_dir_0/Game of Thrones/Season 1/Game of Thrones - S01E03 - Lord Snow Bluray-1080p.ass","/series_dir_0/Game of Thrones/Season 1/Game of Thrones - S01E03 - Lord Snow Bluray-1080p.srt"],media_server_inside_video_id:""}];return(0,ee.rV)(),(e,t)=>((0,s.wg)(),(0,s.j4)($,{"is-movie":a,"media-data":l}))}},le=ae,se=le}}]);