"use strict";(globalThis["webpackChunkchinese_sub_finder_panel"]=globalThis["webpackChunkchinese_sub_finder_panel"]||[]).push([[696],{3696:(l,e,t)=>{t.r(e),t.d(e,{default:()=>vl});t(3610);var a=t(3673),n=t(1959),i=t(2323),o=t(7817),d=t(9897),u=t(1315);const s=0,r=1,_=2,p=3,c=4,m=5,b={[s]:"等待下载",[r]:"处理中",[_]:"失败",[p]:"已完成",[c]:"下载中",[m]:"忽略"},g={[s]:"#bbb",[r]:"#3874CB",[p]:"#59B755",[_]:"#EB5451",[c]:"#3874CB",[m]:"#F5DA5F"},w=Object.keys(b).map((l=>({label:b[l],value:parseInt(l,10)})));var v=t(8825),f=t(3822),y=t(1244);const h={class:"log-viewer col bg-grey-2 overflow-auto relative-position"},k={__name:"LogViewerRaw",props:{logLines:{type:Array,default:()=>[]}},setup(l){const e=l,t=(0,f.CV)("logArea"),o=()=>e.logLines.join("\n");return(0,a.YP)((()=>e.logLines.length),(()=>{const l=t.value.$el;l.scrollTop+l.clientHeight>=l.scrollHeight-10&&(0,a.Y3)((()=>{t.value.scrollTo(e.logLines.length-1)}))})),(e,d)=>{const u=(0,a.up)("q-virtual-scroll");return(0,a.wg)(),(0,a.iD)("div",h,[(0,a.Wm)(u,{ref_key:"logArea",ref:t,class:"full-height q-pa-sm",items:l.logLines},{default:(0,a.w5)((({item:l,index:e})=>[((0,a.wg)(),(0,a.iD)("div",{key:e,style:{"white-space":"nowrap","line-height":"2"}},(0,i.zw)(l),1))])),_:1},8,["items"]),l.logLines.length?((0,a.wg)(),(0,a.j4)((0,n.SU)(y.Z),{key:0,class:"copy-btn hidden absolute-top-right q-ma-md","get-text":o})):(0,a.kq)("",!0)])}}};var q=t(4260),W=t(9698),Z=t(7518),j=t.n(Z);const S=(0,q.Z)(k,[["__scopeId","data-v-09fa08bc"]]),x=S;j()(k,"components",{QVirtualScroll:W.Z});const z=(0,a._)("div",{class:"text-body1"},"任务日志",-1),V={__name:"JobLogBtnDialog",props:{data:{type:Object}},setup(l){const e=l,t=(0,n.iH)(!1),i=(0,n.iH)([]),u=async()=>{const[l,t]=await o.Z.getLog(e.data.id);null!=t?d.j.error(t.message):i.value=l?.one_line},s=()=>{u()};return(l,e)=>{const o=(0,a.up)("q-btn"),d=(0,a.up)("q-card-section"),u=(0,a.up)("q-separator"),r=(0,a.up)("q-card"),_=(0,a.up)("q-dialog");return(0,a.wg)(),(0,a.iD)(a.HY,null,[(0,a.Wm)(o,{label:"任务日志",flat:"",dense:"",onClick:e[0]||(e[0]=l=>t.value=!0),color:"primary"}),(0,a.Wm)(_,{modelValue:t.value,"onUpdate:modelValue":e[1]||(e[1]=l=>t.value=l),onBeforeShow:s},{default:(0,a.w5)((()=>[(0,a.Wm)(r,{style:{width:"900px","max-width":"900px"}},{default:(0,a.w5)((()=>[(0,a.Wm)(d,null,{default:(0,a.w5)((()=>[z])),_:1}),(0,a.Wm)(u),(0,a.Wm)(d,null,{default:(0,a.w5)((()=>[(0,a.Wm)((0,n.SU)(x),{"log-lines":i.value,style:{height:"500px"}},null,8,["log-lines"])])),_:1})])),_:1})])),_:1},8,["modelValue"])],64)}}};var Q=t(2165),U=t(6778),C=t(151),D=t(5589),H=t(5869);const B=V,L=B;j()(V,"components",{QBtn:Q.Z,QDialog:U.Z,QCard:C.Z,QCardSection:D.Z,QSeparator:H.Z});const T=l=>((0,a.dD)("data-v-2352b376"),l=l(),(0,a.Cn)(),l),I=T((()=>(0,a._)("div",{class:"text-body1"},"任务详情",-1))),O={class:"job-detail-table"},P=T((()=>(0,a._)("td",null,"ID",-1))),Y=T((()=>(0,a._)("td",null,"状态",-1))),A=T((()=>(0,a._)("td",null,"类型",-1))),N=T((()=>(0,a._)("td",null,"路径",-1))),F=T((()=>(0,a._)("td",null,"名称",-1))),$=T((()=>(0,a._)("td",null,"特征码",-1))),E=T((()=>(0,a._)("td",null,"连续剧目录",-1))),J=T((()=>(0,a._)("td",null,"季",-1))),M=T((()=>(0,a._)("td",null,"集",-1))),R=T((()=>(0,a._)("td",null,"媒体服务器ID",-1))),G=T((()=>(0,a._)("td",null,"优先级",-1))),K=T((()=>(0,a._)("td",null,"视频创建时间",-1))),X=T((()=>(0,a._)("td",null,"任务创建时间",-1))),ll=T((()=>(0,a._)("td",null,"更新时间",-1))),el=T((()=>(0,a._)("td",null,"错误信息",-1))),tl=T((()=>(0,a._)("td",null,"下载次数",-1))),al=T((()=>(0,a._)("td",null,"重试次数",-1))),nl={__name:"JobDetailBtnDialog",props:{data:{type:Object}},setup(l){const e=(0,n.iH)(!1);return(t,o)=>{const d=(0,a.up)("q-btn"),s=(0,a.up)("q-card-section"),r=(0,a.up)("q-separator"),_=(0,a.up)("q-card"),p=(0,a.up)("q-dialog");return(0,a.wg)(),(0,a.iD)(a.HY,null,[(0,a.Wm)(d,{label:"详情",flat:"",dense:"",onClick:o[0]||(o[0]=l=>e.value=!0),color:"primary"}),(0,a.Wm)(p,{modelValue:e.value,"onUpdate:modelValue":o[1]||(o[1]=l=>e.value=l)},{default:(0,a.w5)((()=>[(0,a.Wm)(_,{style:{width:"900px","max-width":"900px"}},{default:(0,a.w5)((()=>[(0,a.Wm)(s,null,{default:(0,a.w5)((()=>[I])),_:1}),(0,a.Wm)(r),(0,a.Wm)(s,null,{default:(0,a.w5)((()=>[(0,a._)("table",O,[(0,a._)("tbody",null,[(0,a._)("tr",null,[P,(0,a._)("td",null,(0,i.zw)(l.data.id),1)]),(0,a._)("tr",null,[Y,(0,a._)("td",null,(0,i.zw)((0,n.SU)(b)[l.data.job_status]),1)]),(0,a._)("tr",null,[A,(0,a._)("td",null,(0,i.zw)((0,n.SU)(u.uN)[l.data.video_type]),1)]),(0,a._)("tr",null,[N,(0,a._)("td",null,(0,i.zw)(l.data.video_f_path),1)]),(0,a._)("tr",null,[F,(0,a._)("td",null,(0,i.zw)(l.data.video_name),1)]),(0,a._)("tr",null,[$,(0,a._)("td",null,(0,i.zw)(l.data.feature),1)]),l.data.video_type===(0,n.SU)(u.EH)?((0,a.wg)(),(0,a.iD)(a.HY,{key:0},[(0,a._)("tr",null,[E,(0,a._)("td",null,(0,i.zw)(l.data.series_root_dir_path),1)]),(0,a._)("tr",null,[J,(0,a._)("td",null,(0,i.zw)(l.data.season),1)]),(0,a._)("tr",null,[M,(0,a._)("td",null,(0,i.zw)(l.data.episode),1)])],64)):(0,a.kq)("",!0),(0,a._)("tr",null,[R,(0,a._)("td",null,(0,i.zw)(l.data.media_server_inside_video_id),1)]),(0,a._)("tr",null,[G,(0,a._)("td",null,(0,i.zw)(l.data.task_priority),1)]),(0,a._)("tr",null,[K,(0,a._)("td",null,(0,i.zw)(l.data.created_time),1)]),(0,a._)("tr",null,[X,(0,a._)("td",null,(0,i.zw)(l.data.added_time),1)]),(0,a._)("tr",null,[ll,(0,a._)("td",null,(0,i.zw)(l.data.update_time),1)]),(0,a._)("tr",null,[el,(0,a._)("td",null,(0,i.zw)(l.data.error_info),1)]),(0,a._)("tr",null,[tl,(0,a._)("td",null,(0,i.zw)(l.data.download_times),1)]),(0,a._)("tr",null,[al,(0,a._)("td",null,(0,i.zw)(l.data.retry_times),1)])])])])),_:1})])),_:1})])),_:1},8,["modelValue"])],64)}}},il=(0,q.Z)(nl,[["__scopeId","data-v-2352b376"]]),ol=il;j()(nl,"components",{QBtn:Q.Z,QDialog:U.Z,QCard:C.Z,QCardSection:D.Z,QSeparator:H.Z});const dl={class:"row items-center"},ul={class:"q-gutter-xs"},sl={class:"q-gutter-sm row"},rl={__name:"index",setup(l){const e=(0,v.Z)(),t=[{label:"状态",field:"job_status",name:"jobStatus",align:"left"},{label:"类型",field:"video_type",format:l=>u.uN[l],align:"left"},{label:"名称",field:"video_name",width:"100px",align:"left"},{label:"优先级",field:"task_priority",align:"left"},{label:"创建时间",field:"added_time",align:"left"},{label:"更新时间",field:"update_time",align:"left"},{label:"错误信息",field:"error_info",align:"left"},{label:"下载次数",field:"download_times",align:"left"},{label:"重试次数",field:"retry_times",align:"left"},{label:"操作",name:"actions",align:"left",headerClasses:"sticky-column-header"}],r=(0,n.iH)([]),_=(0,n.iH)([]),p=(0,n.qj)({search:"",status:null,videoType:null,priority:null}),c={0:"高",1:"高",2:"高",3:"高",4:"中",5:"中",6:"中",7:"低",8:"低",9:"低",10:"低"},f=async()=>{const[l,e]=await o.Z.getList();null!==e?d.j.error(e.message):r.value=l.all_jobs},y=()=>{_.value=[],f()},h=(0,a.Fl)((()=>{const{search:l,status:e,videoType:t,priority:a}=p;return r.value.filter((n=>{if(""!==l&&!(n.video_name.includes(l)||n.video_f_path.includes(l)||n.series_root_dir_path.includes(l)||String(n.media_server_inside_video_id)===l))return!1;if(null!==e&&n.job_status!==e)return!1;if(null!==t&&n.video_type!==t)return!1;const i=(l,e,t)=>l>=e&&l<=t;if(null!==a&&n.task_priority!==a){if("high"===a&&!i(n.task_priority,0,3))return!1;if("low"===a&&!i(n.task_priority,7,10))return!1;if("middle"===a&&!i(n.task_priority,4,6))return!1}return!0}))})),k=[{label:"全部",value:null},...w],q=[{label:"全部",value:null},...Object.keys(u.uN).map((l=>({label:u.uN[l],value:parseInt(l,10)})))],W=[{label:"全部",value:null},{label:"低（7-10）",value:"low"},{label:"中（4-6）",value:"middle"},{label:"高（0-3）",value:"high"}],Z=async l=>{e.dialog({title:"操作确认",message:"确认修改优先级？",cancel:!0,persistent:!0,focus:"none"}).onOk((async()=>{const e=await Promise.allSettled(_.value.map((e=>o.Z.update(e.id,{task_priority:l})))),t=e.filter((({value:[,l]})=>null!==l)).length;t>0?d.j.error(`${t}个任务修改优先级失败！`):d.j.success("成功修改优先级"),y()}))},j=async()=>{e.dialog({title:"修改状态",message:"需要变更成哪个状态？",options:{type:"radio",items:[{label:b[s],value:s},{label:b[m],value:m}]},cancel:!0,persistent:!0}).onOk((async l=>{const e=await Promise.allSettled(_.value.map((e=>o.Z.update(e.id,{job_status:l,task_priority:c[e.task_priority]})))),t=e.filter((({value:[,l]})=>null!==l)).length;t>0?d.j.error(`${t}个任务修改状态失败！`):d.j.success("成功修改任务状态"),y()}))};return(0,a.bv)((()=>{f()})),(l,e)=>{const o=(0,a.up)("q-btn"),d=(0,a.up)("q-space"),u=(0,a.up)("q-select"),s=(0,a.up)("q-input"),r=(0,a.up)("q-separator"),c=(0,a.up)("q-td"),m=(0,a.up)("q-table"),w=(0,a.up)("q-page");return(0,a.wg)(),(0,a.j4)(w,{class:"q-pa-md"},{default:(0,a.w5)((()=>[(0,a._)("div",dl,[(0,a._)("div",ul,[(0,a.Wm)(o,{disable:0===_.value.length,size:"md",icon:"expand_less",label:"升级",color:"primary",onClick:e[0]||(e[0]=l=>Z("high"))},null,8,["disable"]),(0,a.Wm)(o,{disable:0===_.value.length,size:"md",icon:"expand_more",label:"降级",color:"primary",onClick:e[1]||(e[1]=l=>Z("low"))},null,8,["disable"]),(0,a.Wm)(o,{disable:0===_.value.length,size:"md",label:"修改状态",color:"primary",onClick:j},null,8,["disable"])]),(0,a.Wm)(d),(0,a._)("div",sl,[(0,a.Wm)(u,{label:"状态",modelValue:p.status,"onUpdate:modelValue":e[2]||(e[2]=l=>p.status=l),modelModifiers:{number:!0},options:k,outlined:"",dense:"","map-options":"","emit-value":"",style:{width:"120px"}},null,8,["modelValue"]),(0,a.Wm)(u,{modelValue:p.videoType,"onUpdate:modelValue":e[3]||(e[3]=l=>p.videoType=l),modelModifiers:{number:!0},options:q,label:"类型","emit-value":"","map-options":"",outlined:"",dense:"",style:{width:"100px"}},null,8,["modelValue"]),(0,a.Wm)(u,{modelValue:p.priority,"onUpdate:modelValue":e[4]||(e[4]=l=>p.priority=l),options:W,label:"优先级",outlined:"",dense:"","map-options":"","emit-value":"",style:{width:"130px"}},null,8,["modelValue"]),(0,a.Wm)(s,{modelValue:p.search,"onUpdate:modelValue":e[5]||(e[5]=l=>p.search=l),outlined:"",label:"输入关键字搜索",dense:""},null,8,["modelValue"])])]),(0,a.Wm)(r,{class:"q-mt-md"}),(0,a.Wm)(m,{columns:t,rows:(0,n.SU)(h),flat:"",selection:"multiple",selected:_.value,"onUpdate:selected":e[6]||(e[6]=l=>_.value=l),class:"sticky-column-table",pagination:{rowsPerPage:20}},{"body-cell-jobStatus":(0,a.w5)((({row:l})=>[(0,a.Wm)(c,null,{default:(0,a.w5)((()=>[(0,a._)("span",{style:(0,i.j5)({background:(0,n.SU)(g)[l.job_status],color:"white",borderRadius:"5px",padding:"2px 6px",fontSize:"12px"})},(0,i.zw)((0,n.SU)(b)[l.job_status]),5)])),_:2},1024)])),"body-cell-actions":(0,a.w5)((({row:l})=>[(0,a.Wm)(c,null,{default:(0,a.w5)((()=>[(0,a.Wm)((0,n.SU)(ol),{data:l},null,8,["data"]),(0,a.Wm)((0,n.SU)(L),{data:l},null,8,["data"])])),_:2},1024)])),_:1},8,["rows","selected"])])),_:1})}}};var _l=t(4379),pl=t(2025),cl=t(8516),ml=t(4842),bl=t(2462),gl=t(3884);const wl=rl,vl=wl;j()(rl,"components",{QPage:_l.Z,QBtn:Q.Z,QSpace:pl.Z,QSelect:cl.Z,QInput:ml.Z,QSeparator:H.Z,QTable:bl.Z,QTd:gl.Z})}}]);