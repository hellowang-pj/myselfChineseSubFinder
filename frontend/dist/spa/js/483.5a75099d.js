"use strict";(globalThis["webpackChunkchinese_sub_finder_panel"]=globalThis["webpackChunkchinese_sub_finder_panel"]||[]).push([[483],{5483:(e,l,a)=>{a.r(l),a.d(l,{default:()=>Se});a(3610),a(5663);var t=a(3673),i=a(1959),o=a(2323),n=a(4739),s=a(8880),u=a(7493),d=a(9897),r=a(1315),p=a(8298),c=a(8825);const m=e=>{const l=(0,i.iH)(!1),a=(0,i.iH)([]),o=()=>{!0===l.value&&a.value.splice(0,a.value.length),!1!==l.value&&"maybe"!==l.value||a.value.splice(0,a.value.length,...e.value)};return(0,t.YP)((()=>a.value?.length),(()=>{void 0!==a.value&&(a.value.length===e.value.length?l.value=!0:0===a.value.length?l.value=!1:l.value="maybe")})),{selectAllValue:l,selection:a,handleSelectAll:o}};var _=a(8534),v=a(5936),f=a(2798),h=a(9608),w=a(3718);const g=e=>{const l=e.match(/s\d+e(\d+)/i);if(l)return parseInt(l[1],10);const a=e.match(/第(\d+)集/i);return a?parseInt(a[1],10):null},y={key:0,class:"drag-mask row items-center justify-center text-white text-h5"},b=(0,t._)("div",{class:"text-body1"},"批量上传",-1),k={key:0,class:"upload-area column justify-center items-center q-gutter-sm",style:{height:"500px"}},W=(0,t._)("div",null,"拖拽文件上传",-1),q=(0,t._)("div",null,"或者",-1),Z={key:0},S={__name:"BtnUploadMultipleForTv",props:{items:Array,dense:{type:Boolean,default:!1}},setup(e){const l=e,a=(0,i.iH)(null),r=(0,i.iH)(null),p=(0,i.iH)(!1),c=(0,i.iH)(!1),m=(0,i.qj)({}),_=(0,i.iH)(!1),f=(0,i.iH)([]),h=()=>{p.value=!0},w=async()=>{c.value=!0;for(const e of Object.keys(m)){const l=m[e];if(l){const a=new FormData;a.append("video_f_path",l.video_f_path),a.append("file",f.value.find((l=>l.name===e))),await u.Z.uploadSubtitle(a),await(0,n.Dr)(),await new Promise((e=>setTimeout(e,1e3))),v.Z.emit("subtitle-uploaded")}}d.j.success("字幕上传成功。如果设置开启了“自动校正时间轴”，处理需要一些时间，请耐心等待",{timeout:3e3}),c.value=!1,p.value=!1},S=e=>{const a=g(e.name),t=l.items.find((e=>e.episode===a));m[e.name]=t||null},U=e=>{/\.srt|\.ass|\.ssa|\.sbv|\.webvtt/.test(e.name)&&(f.value.some((l=>l.name===e.name))||(f.value.push(e),S(e)))},Q=e=>{[].forEach.call(e,(e=>{U(e)}))},C=e=>{e.preventDefault(),_.value=!0},x=e=>{e.preventDefault()},j=e=>{e.preventDefault();const{files:l}=e.dataTransfer;[].forEach.call(l,(e=>{U(e)})),Q(l),_.value=!1},D=e=>{f.value=f.value.filter((l=>l.name!==e.name)),delete m[e.name]},V=()=>{f.value=[],Object.keys(m).forEach((e=>{delete m[e]}))};return(l,i)=>{const n=(0,t.up)("q-btn"),u=(0,t.up)("q-input"),d=(0,t.up)("q-card-section"),v=(0,t.up)("q-separator"),g=(0,t.up)("q-item-section"),S=(0,t.up)("q-item"),U=(0,t.up)("q-select"),H=(0,t.up)("q-list"),P=(0,t.up)("q-spinner-facebook"),I=(0,t.up)("q-card-actions"),$=(0,t.up)("q-card"),T=(0,t.up)("q-dialog"),Y=(0,t.Q2)("ripple"),E=(0,t.Q2)("close-popup");return(0,t.wg)(),(0,t.iD)(t.HY,null,[(0,t.Wm)(n,(0,t.dG)({color:"primary",flat:"",icon:"upload"},l.$attrs,{label:e.dense?"":"本地上传整季字幕",onClick:h,title:"选择多个字幕上传"}),null,16,["label"]),(0,t.wy)((0,t.Wm)(u,{type:"file",ref_key:"qFile",ref:r,modelValue:a.value,"onUpdate:modelValue":[i[0]||(i[0]=e=>a.value=e),Q],multiple:"",accept:".srt,.ass,.ssa,.sbv,.webvtt"},null,8,["modelValue"]),[[s.F8,!1]]),(0,t.Wm)(T,{modelValue:p.value,"onUpdate:modelValue":i[3]||(i[3]=e=>p.value=e),onBeforeShow:V},{default:(0,t.w5)((()=>[(0,t.Wm)($,{class:"relative-position",style:{"min-width":"900px"},onDragover:C,onDrop:j,onDragleave:x},{default:(0,t.w5)((()=>[_.value?((0,t.wg)(),(0,t.iD)("div",y," 放置字幕文件到此处 ")):(0,t.kq)("",!0),(0,t.Wm)(d,null,{default:(0,t.w5)((()=>[b])),_:1}),(0,t.Wm)(v),(0,t.Wm)(d,{style:{"min-height":"500px"}},{default:(0,t.w5)((()=>[0===f.value.length?((0,t.wg)(),(0,t.iD)("div",k,[W,q,(0,t.Wm)(n,{color:"primary",label:"选择文件",dense:"",flat:"",onClick:i[1]||(i[1]=()=>r.value.$el.click())})])):((0,t.wg)(),(0,t.iD)(t.HY,{key:1},[(0,t.Wm)(n,{color:"primary",label:"添加字幕文件",onClick:i[2]||(i[2]=()=>r.value.$el.click()),class:"q-mb-sm"}),(0,t.Wm)(H,{separator:""},{default:(0,t.w5)((()=>[((0,t.wg)(!0),(0,t.iD)(t.HY,null,(0,t.Ko)(f.value,(l=>((0,t.wg)(),(0,t.j4)(S,{key:l.name},{default:(0,t.w5)((()=>[(0,t.Wm)(g,null,{default:(0,t.w5)((()=>[(0,t.Uk)((0,o.zw)(l.name),1)])),_:2},1024),(0,t.Wm)(g,{side:""},{default:(0,t.w5)((()=>[(0,t.Wm)(U,{disable:c.value,modelValue:m[l.name],"onUpdate:modelValue":e=>m[l.name]=e,options:e.items,dense:"",filled:"",style:{width:"200px"},label:"选择对应的集数",clearable:""},{selected:(0,t.w5)((()=>[m[l.name]?((0,t.wg)(),(0,t.iD)("span",Z," 第"+(0,o.zw)(m[l.name].episode)+"集 ",1)):(0,t.kq)("",!0)])),option:(0,t.w5)((e=>[(0,t.wy)(((0,t.wg)(),(0,t.j4)(S,(0,t.dG)(e.itemProps,{clickable:""}),{default:(0,t.w5)((()=>[(0,t.Wm)(g,null,{default:(0,t.w5)((()=>[(0,t.Uk)("第"+(0,o.zw)(e.opt.episode)+"集",1)])),_:2},1024)])),_:2},1040)),[[Y]])])),_:2},1032,["disable","modelValue","onUpdate:modelValue","options"])])),_:2},1024),(0,t.Wm)(g,{side:""},{default:(0,t.w5)((()=>[(0,t.Wm)(n,{color:"negative",flat:"",icon:"close",dense:"",title:"删除",rounded:"",onClick:e=>D(l)},null,8,["onClick"])])),_:2},1024)])),_:2},1024)))),128))])),_:1})],64))])),_:1}),(0,t.Wm)(v),(0,t.Wm)(I,{align:"right"},{default:(0,t.w5)((()=>[(0,t.wy)((0,t.Wm)(n,{class:"q-px-md",flat:"",color:"primary",label:"关闭"},null,512),[[E]]),(0,t.Wm)(n,{class:"q-px-md",type:"submit",color:"primary",loading:c.value,onClick:w,label:"上传"},{loading:(0,t.w5)((()=>[(0,t.Wm)(P)])),_:1},8,["loading"])])),_:1})])),_:1})])),_:1},8,["modelValue"])],64)}}};var U=a(2165),Q=a(4842),C=a(6778),x=a(151),j=a(5589),D=a(5869),V=a(7011),H=a(3414),P=a(2035),I=a(8516),$=a(9367),T=a(8719),Y=a(6489),E=a(677),z=a(7518),F=a.n(z);const O=S,A=O;F()(S,"components",{QBtn:U.Z,QInput:Q.Z,QDialog:C.Z,QCard:x.Z,QCardSection:j.Z,QSeparator:D.Z,QList:V.Z,QItem:H.Z,QItemSection:P.Z,QSelect:I.Z,QCardActions:$.Z,QSpinnerFacebook:T.Z}),F()(S,"directives",{Ripple:Y.Z,ClosePopup:E.Z});var B=a(9238);const K={class:"text-h6"},L={class:"row items-center q-ml-md q-py-none"},M=["href"],G={__name:"DialogTVDetail",props:{data:Object},setup(e){const l=e,a=(0,c.Z)(),g=(0,t.Fl)((()=>{const e=[];return l.data?.one_video_info.forEach((l=>{const{season:a}=l,t=e.findIndex((e=>e.season===a));-1===t?e.push({season:a,episodes:[l]}):e[t].episodes.push(l)})),e.sort(((e,l)=>e.season-l.season)),e.forEach((e=>{e.episodes.sort(((e,l)=>e.episode-l.episode))})),e})),y=(0,i.iH)(null);(0,t.YP)(g,(()=>{g.value.length&&null===y.value&&(y.value=g.value[0].season)}));const b=(0,t.Fl)((()=>g.value.find((e=>e.season===y.value))?.episodes??[])),{selectAllValue:k,handleSelectAll:W,selection:q}=m(b);(0,t.YP)(y,(()=>{q.value=[]}));const Z=e=>e<10?`0${e}`:e,S=(0,i.iH)(!1),U=e=>p.Z.BACKEND_URL+e.split(/\/|\\/).join("/"),Q=async e=>{const l=e instanceof Array?e:[e];a.dialog({title:`添加 ${l.length}个 视频任务到下载队列`,message:"选择下载任务的类型：",options:{model:3,type:"radio",items:[{label:"插队任务",value:3},{label:"一次性任务（执行成功后忽略该任务）",value:0}]},cancel:!0,persistent:!0}).onOk((async e=>{const a=l.map((async l=>{const[,a]=await u.Z.downloadSubtitle({video_type:r.EH,physical_video_file_full_path:l.video_f_path,task_priority_level:e,media_server_inside_video_id:l.media_server_inside_video_id});return null!==a?Promise.reject(a):Promise.resolve()})),t=await Promise.allSettled(a),i=t.filter((e=>"fulfilled"===e.status)).length,o=t.filter((e=>"rejected"===e.status)).length,n=`成功添加 ${i} 个任务到下载队列${o?`，失败 ${o} 个`:""}`;d.j.success(n)}))},C=async e=>{a.dialog({title:(e?"锁定":"解锁")+"选中视频",message:`确定要${e?"锁定":"解锁"}选中视频吗？`,cancel:!0,persistent:!0}).onOk((async()=>{const[,l]=await u.Z.setSkipInfo({video_skip_infos:q.value.map((l=>({video_type:r.EH,physical_video_file_full_path:l.video_f_path,is_bluray:!1,is_skip:e})))});if(null!==l)return void d.j.error(l.message);const[a,t]=await u.Z.getSkipInfo({video_skip_infos:q.value.map((e=>({video_type:r.EH,physical_video_file_full_path:e.video_f_path,is_bluray:!1,is_skip:!0})))});null===t?(q.value.forEach(((e,l)=>{v.Z.emit(`refresh-skip-status-${e.video_f_path}`,a.is_skips[l])})),d.j.success("操作成功")):d.j.error(t.message)}))},x=()=>{Q(q.value)};return(l,a)=>{const u=(0,t.up)("q-card-section"),d=(0,t.up)("q-tab"),p=(0,t.up)("q-tabs"),c=(0,t.up)("q-separator"),m=(0,t.up)("q-checkbox"),v=(0,t.up)("q-btn"),j=(0,t.up)("q-space"),D=(0,t.up)("q-item-section"),V=(0,t.up)("q-item"),H=(0,t.up)("q-list"),P=(0,t.up)("q-popup-proxy"),I=(0,t.up)("q-tab-panel"),$=(0,t.up)("q-tab-panels"),T=(0,t.up)("q-card"),Y=(0,t.up)("q-dialog");return(0,t.wg)(),(0,t.iD)(t.HY,null,[(0,t._)("span",{onClick:a[0]||(a[0]=(0,s.iM)((e=>S.value=!0),["stop"]))},[(0,t.WI)(l.$slots,"default")]),(0,t.Wm)(Y,{modelValue:S.value,"onUpdate:modelValue":a[8]||(a[8]=e=>S.value=e)},{default:(0,t.w5)((()=>[(0,t.Wm)(T,{style:{width:"900px","max-width":"900px"}},{default:(0,t.w5)((()=>[(0,t.Wm)(u,null,{default:(0,t.w5)((()=>[(0,t._)("div",K,(0,o.zw)(e.data.name)+" 剧集列表",1)])),_:1}),(0,t.Wm)(p,{modelValue:y.value,"onUpdate:modelValue":a[1]||(a[1]=e=>y.value=e),dense:"","active-color":"primary","indicator-color":"primary",align:"justify","narrow-indicator":""},{default:(0,t.w5)((()=>[((0,t.wg)(!0),(0,t.iD)(t.HY,null,(0,t.Ko)((0,i.SU)(g),(e=>((0,t.wg)(),(0,t.j4)(d,{key:e.season,name:e.season,label:`第${e.season}季`,style:{"max-width":"150px"}},null,8,["name","label"])))),128))])),_:1},8,["modelValue"]),(0,t.Wm)(c),(0,t.Wm)(u,{style:{"max-height":"40vh",overflow:"auto"}},{default:(0,t.w5)((()=>[(0,t._)("div",L,[(0,t.Wm)(m,{"model-value":(0,i.SU)(k),"indeterminate-value":"maybe",onClick:(0,i.SU)(W),title:"全选/反选"},null,8,["model-value","onClick"]),(0,t.Wm)(v,{class:"btn-download",color:"primary",label:"下载选中",flat:"",disable:0===(0,i.SU)(q).length,onClick:x},null,8,["disable"]),(0,t.Wm)(v,{class:"btn-download",color:"primary",icon:"lock",title:"锁定选中视频，不进行字幕下载",flat:"",disable:0===(0,i.SU)(q).length,onClick:a[2]||(a[2]=e=>C(!0))},null,8,["disable"]),(0,t.Wm)(v,{class:"btn-download",color:"primary",icon:"lock_open",title:"解锁选中视频",flat:"",disable:0===(0,i.SU)(q).length,onClick:a[3]||(a[3]=e=>C(!1))},null,8,["disable"]),(0,t.Wm)(j),(0,t.Wm)((0,i.SU)(w.Z),{"search-package":"","package-episodes":(0,i.SU)(b),label:"搜索本季字幕包",size:"md"},null,8,["package-episodes"]),(0,t.Wm)((0,i.SU)(A),{items:(0,i.SU)(b)},null,8,["items"])]),(0,t.Wm)($,{modelValue:y.value,"onUpdate:modelValue":a[7]||(a[7]=e=>y.value=e),animated:""},{default:(0,t.w5)((()=>[((0,t.wg)(!0),(0,t.iD)(t.HY,null,(0,t.Ko)((0,i.SU)(g),(({season:e,episodes:l})=>((0,t.wg)(),(0,t.j4)(I,{key:e,name:e,style:{padding:"0"}},{default:(0,t.w5)((()=>[(0,t.Wm)(H,{dense:""},{default:(0,t.w5)((()=>[((0,t.wg)(!0),(0,t.iD)(t.HY,null,(0,t.Ko)(l,(e=>((0,t.wg)(),(0,t.j4)(V,{key:e.name},{default:(0,t.w5)((()=>[(0,t.Wm)(D,{side:"",top:""},{default:(0,t.w5)((()=>[(0,t.Wm)(m,{modelValue:(0,i.SU)(q),"onUpdate:modelValue":a[4]||(a[4]=e=>(0,i.dq)(q)?q.value=e:null),val:e},null,8,["modelValue","val"])])),_:2},1024),(0,t.Wm)(D,null,{default:(0,t.w5)((()=>[(0,t.Uk)("第 "+(0,o.zw)(Z(e.episode))+" 集",1)])),_:2},1024),e.sub_f_path_list.length?((0,t.wg)(),(0,t.j4)(D,{key:0,side:""},{default:(0,t.w5)((()=>[(0,t.Wm)((0,i.SU)(h.Z),{"subtitle-url-list":e.sub_url_list,path:e.video_f_path},null,8,["subtitle-url-list","path"])])),_:2},1024)):(0,t.kq)("",!0),(0,t.Wm)(D,{side:""},{default:(0,t.w5)((()=>[(0,t.Wm)((0,i.SU)(f.Z),{path:e.video_f_path},null,8,["path"])])),_:2},1024),(0,t.Wm)(D,{side:""},{default:(0,t.w5)((()=>[(0,t.Wm)((0,i.SU)(_.Z),{path:e.video_f_path,"video-type":(0,i.SU)(r.EH)},null,8,["path","video-type"])])),_:2},1024),(0,t.Wm)(D,{side:""},{default:(0,t.w5)((()=>[e.sub_f_path_list.length?((0,t.wg)(),(0,t.j4)(v,{key:0,color:"black",round:"",flat:"",dense:"",icon:"closed_caption",onClick:a[5]||(a[5]=(0,s.iM)((()=>{}),["stop"])),title:"已有字幕"},{default:(0,t.w5)((()=>[(0,t.Wm)(P,{anchor:"top right"},{default:(0,t.w5)((()=>[(0,t.Wm)(H,{dense:""},{default:(0,t.w5)((()=>[((0,t.wg)(!0),(0,t.iD)(t.HY,null,(0,t.Ko)(e.sub_url_list,((e,l)=>((0,t.wg)(),(0,t.j4)(V,{key:e},{default:(0,t.w5)((()=>[(0,t.Wm)(D,{side:""},{default:(0,t.w5)((()=>[(0,t.Uk)((0,o.zw)(l+1)+".",1)])),_:2},1024),(0,t.Wm)(D,{class:"overflow-hidden ellipsis",title:e.split(/\/|\\/).pop()},{default:(0,t.w5)((()=>[(0,t._)("a",{class:"text-primary",href:U(e),target:"_blank"},(0,o.zw)(e.split(/\/|\\/).pop()),9,M)])),_:2},1032,["title"]),(0,t.Wm)(D,{side:""},{default:(0,t.w5)((()=>[(0,t.Wm)(v,{color:"primary",round:"",flat:"",dense:"",icon:"construction",title:"字幕时间轴校准"+((0,i.SU)(B.OP).advanced_settings.fix_time_line?"":"（此功能需要在进阶设置里开启自动校正字幕时间轴，检测到你当前尚未开启此选项）"),onClick:l=>(0,i.SU)(n.qb)(e),disable:!(0,i.SU)(B.OP).advanced_settings.fix_time_line},null,8,["title","onClick","disable"])])),_:2},1024)])),_:2},1024)))),128))])),_:2},1024)])),_:2},1024)])),_:2},1024)):((0,t.wg)(),(0,t.j4)(v,{key:1,color:"grey",round:"",flat:"",dense:"",icon:"closed_caption",onClick:a[6]||(a[6]=(0,s.iM)((()=>{}),["stop"])),title:"没有字幕"}))])),_:2},1024),(0,t.Wm)(D,{side:""},{default:(0,t.w5)((()=>[(0,t.Wm)((0,i.SU)(w.Z),{size:"md",round:"",path:e.video_f_path,season:e.season,episode:e.episode},null,8,["path","season","episode"])])),_:2},1024),(0,t.Wm)(D,{side:""},{default:(0,t.w5)((()=>[(0,t.Wm)(v,{class:"btn-download",color:"primary",round:"",flat:"",dense:"",icon:"download_for_offline",title:"添加到下载队列",onClick:l=>Q(e)},null,8,["onClick"])])),_:2},1024)])),_:2},1024)))),128))])),_:2},1024)])),_:2},1032,["name"])))),128))])),_:1},8,["modelValue"])])),_:1})])),_:1})])),_:1},8,["modelValue"])],64)}}};var R=a(7547),N=a(3269),X=a(5735),J=a(2025),ee=a(5906),le=a(6602),ae=a(3944);const te=G,ie=te;F()(G,"components",{QDialog:C.Z,QCard:x.Z,QCardSection:j.Z,QTabs:R.Z,QTab:N.Z,QSeparator:D.Z,QCheckbox:X.Z,QBtn:U.Z,QSpace:J.Z,QTabPanels:ee.Z,QTabPanel:le.Z,QList:V.Z,QItem:H.Z,QItemSection:P.Z,QPopupProxy:ae.Z});const oe={class:"area-cover q-mb-sm relative-position"},ne={key:0,style:{width:"160px",height:"200px"}},se=["title"],ue={class:"row items-center"},de={__name:"ListItemTV",props:{data:Object},setup(e){const l=e,a=(0,i.iH)(null),s=(0,i.iH)(null),d=async()=>{const[e]=await u.Z.getTvPoster({name:l.data.name,main_root_dir_f_path:l.data.main_root_dir_f_path,root_dir_path:l.data.root_dir_path});a.value=e},r=async()=>{const[e]=await u.Z.getTvDetail({name:l.data.name,main_root_dir_f_path:l.data.main_root_dir_f_path,root_dir_path:l.data.root_dir_path});s.value=e},p=(0,t.Fl)((()=>s.value?.one_video_info.filter((e=>e.sub_f_path_list.length>0)).length));return(0,t.YP)(n.FC,((e,l)=>{s.value?.one_video_info.some((e=>l.map((e=>e.video_f_path)).includes(e.video_f_path)))&&!s.value?.one_video_info.some((l=>e.map((e=>e.video_f_path)).includes(l.video_f_path)))&&r()})),(0,t.bv)((()=>{d(),r()})),(l,u)=>{const d=(0,t.up)("q-img"),r=(0,t.up)("q-space"),c=(0,t.up)("q-btn"),m=(0,t.up)("q-card");return(0,t.wg)(),(0,t.j4)(m,{flat:"",square:""},{default:(0,t.w5)((()=>[(0,t._)("div",oe,[a.value?.url?((0,t.wg)(),(0,t.j4)(d,{key:1,src:(0,i.SU)(n.Gr)(a.value.url),class:"content-width bg-grey-2","no-spinner":"",style:{width:"160px",height:"200px"},fit:"cover"},null,8,["src"])):((0,t.wg)(),(0,t.iD)("div",ne))]),(0,t._)("div",{class:"content-width text-ellipsis-line-2",title:e.data.name},(0,o.zw)(e.data.name),9,se),(0,t._)("div",ue,[(0,t.Wm)(r),(0,t._)("div",null,[(0,t.Wm)((0,i.SU)(ie),{data:s.value},{default:(0,t.w5)((()=>[(0,i.SU)(p)>0?((0,t.wg)(),(0,t.j4)(c,{key:0,color:"black",flat:"",dense:"",icon:"closed_caption",label:`${(0,i.SU)(p)}/${s.value.one_video_info.length}`,title:"已有字幕"},null,8,["label"])):((0,t.wg)(),(0,t.j4)(c,{key:1,color:"grey",round:"",flat:"",dense:"",icon:"closed_caption",title:"没有字幕"}))])),_:1},8,["data"])])])])),_:1})}}};var re=a(4260),pe=a(4027);const ce=(0,re.Z)(de,[["__scopeId","data-v-fd7e1432"]]),me=ce;F()(de,"components",{QCard:x.Z,QImg:pe.Z,QSpace:J.Z,QBtn:U.Z});var _e=a(7771),ve=a(6960);const fe={class:"row q-gutter-md"},he={key:0,class:"self-center text-grey"},we={key:0,class:"row q-gutter-x-md q-gutter-y-lg"},ge=["onClick"],ye={key:1,class:"q-my-md text-grey"},be={__name:"index",setup(e){const l=(0,c.Z)(),a=(0,i.qj)({hasSubtitle:null,search:""}),s=(0,i.iH)([]),{tvs:p}=(0,n.yX)(),m=(0,t.Fl)((()=>{let e=p.value;const l=e=>e.one_video_info.filter((e=>e.sub_f_path_list.length>0)).length;return 1===a.hasSubtitle&&(e=e.filter((e=>0===l(e)))),2===a.hasSubtitle&&(e=e.filter((e=>l(e)>0&&l(e)<e.one_video_info.length))),3===a.hasSubtitle&&(e=e.filter((e=>l(e)===e.one_video_info.length))),""!==a.search&&(e=e.filter((e=>e.name.toLowerCase().includes(a.search.toLowerCase())))),e})),_=e=>{const l=e.root_dir_path;s.value.includes(l)?s.value=s.value.filter((e=>e!==l)):s.value.push(l)},v=async(e,l)=>{const[a]=await u.Z.getTvDetail({name:e.name,main_root_dir_f_path:e.main_root_dir_f_path,root_dir_path:e.root_dir_path});return u.Z.setSkipInfo({video_skip_infos:a.one_video_info.map((e=>({video_type:r.EH,physical_video_file_full_path:e.video_f_path,is_bluray:!1,is_skip:l})))})},f=async e=>{0!==s.value.length?l.dialog({title:"提示",message:`确定${e?"锁定":"取消锁定"}选中的${s.value.length}项吗？`,cancel:!0,persistent:!0}).onOk((async()=>{await Promise.allSettled(s.value.map((e=>p.value.find((l=>l.root_dir_path===e)))).map((l=>v(l,e)))),s.value=[],d.j.success("操作成功！")})):d.j.warn("请至少选择一项！")};return(e,l)=>{const n=(0,t.up)("q-btn"),u=(0,t.up)("q-space"),d=(0,t.up)("q-icon"),r=(0,t.up)("q-input"),c=(0,t.up)("q-separator"),v=(0,t.up)("q-checkbox"),h=(0,t.up)("q-intersection"),w=(0,t.up)("q-page");return(0,t.wg)(),(0,t.j4)(w,{class:"q-pa-lg"},{default:(0,t.w5)((()=>[(0,t._)("div",fe,[(0,t.Wm)((0,i.SU)(_e.Z)),(0,t.Wm)((0,i.SU)(ve.Z)),(0,t.Wm)(n,{color:"primary",onClick:l[0]||(l[0]=e=>f(!0)),label:"锁定"}),(0,t.Wm)(n,{color:"primary",onClick:l[1]||(l[1]=e=>f(!1)),label:"取消锁定"}),s.value.length?((0,t.wg)(),(0,t.iD)("div",he,"已选中"+(0,o.zw)(s.value.length)+"项",1)):(0,t.kq)("",!0),s.value.length?((0,t.wg)(),(0,t.j4)(n,{key:1,color:"primary",flat:"",onClick:l[2]||(l[2]=e=>s.value=[]),label:"清空选择"})):(0,t.kq)("",!0),(0,t.Wm)(u),(0,t.Wm)(r,{modelValue:a.search,"onUpdate:modelValue":l[3]||(l[3]=e=>a.search=e),outlined:"",dense:"",label:"输入关键字搜索"},{append:(0,t.w5)((()=>[(0,t.Wm)(d,{name:"search"})])),_:1},8,["modelValue"])]),(0,t.Wm)(c,{class:"q-my-md"}),(0,i.SU)(p).length?((0,t.wg)(),(0,t.iD)("div",we,[((0,t.wg)(!0),(0,t.iD)(t.HY,null,(0,t.Ko)((0,i.SU)(m),(e=>((0,t.wg)(),(0,t.j4)(h,{key:e.root_dir_path,style:{width:"160px",height:"280px"},once:""},{default:(0,t.w5)((()=>[(0,t._)("div",{class:(0,o.C_)(["item-wrapper cursor-pointer",{selected:s.value.includes(e.root_dir_path)}]),onClick:l=>_(e)},[(0,t.Wm)((0,i.SU)(me),{data:e,selected:s.value},null,8,["data","selected"]),(0,t.Wm)(v,{"model-value":s.value.includes(e.root_dir_path),class:"absolute-top-right no-pointer-events"},null,8,["model-value"])],10,ge)])),_:2},1024)))),128))])):((0,t.wg)(),(0,t.iD)("div",ye,'当前没有可用视频，点击"更新缓存"按钮可重建缓存'))])),_:1})}}};var ke=a(4379),We=a(4554),qe=a(8218);const Ze=be,Se=Ze;F()(be,"components",{QPage:ke.Z,QBtn:U.Z,QSpace:J.Z,QInput:Q.Z,QIcon:We.Z,QSeparator:D.Z,QIntersection:qe.Z,QCheckbox:X.Z})}}]);