"use strict";(globalThis["webpackChunkchinese_sub_finder_panel"]=globalThis["webpackChunkchinese_sub_finder_panel"]||[]).push([[978],{5787:(e,l,a)=>{a.r(l),a.d(l,{default:()=>ue});a(5663);var r=a(3673),t=a(1959),m=a(8339),o=a(304),u=a(9897);a(3610);const s=(0,t.qj)({defaultSettings:null,form:{username:"",password:"",confirmPassword:"",movieFolder:[""],seriesFolder:[""],mediaServer:"",emby:{url:"",apiKey:"",limitCount:3e3,skipWatched:!0,autoOrManual:!0,movieFolderMap:{},seriesFolderMap:{}}}}),n=async()=>{const[e,l]=await o.Z.getDefaultSettings();null===l?s.defaultSettings=e:u.j.error(l.message)},d=(e,l)=>e.reduce(((e,a)=>(Object.keys(l).includes(a)?e[a]=l[a]:e[a]="",e)),{});(0,r.YP)((()=>s.form.movieFolder),(()=>{s.form.emby.movieFolderMap=d(s.form.movieFolder,s.form.emby.movieFolderMap)}),{deep:!0}),(0,r.YP)((()=>s.form.seriesFolder),(()=>{s.form.emby.seriesFolderMap=d(s.form.seriesFolder,s.form.emby.seriesFolderMap)}),{deep:!0});const i=()=>{(0,r.bv)((()=>{n()}))},f={__name:"AdminAccountForm",setup(e){return(e,l)=>{const a=(0,r.up)("q-input"),m=(0,r.up)("q-form");return(0,r.wg)(),(0,r.j4)(m,{ref:"form",class:"q-gutter-md"},{default:(0,r.w5)((()=>[(0,r.Wm)(a,{filled:"",modelValue:(0,t.SU)(s).form.username,"onUpdate:modelValue":l[0]||(l[0]=e=>(0,t.SU)(s).form.username=e),label:"输入您的用户名",hint:"用户名必须在3-16个字符以内，只能包含字母、数字、下划线","lazy-rules":"",rules:[e=>e&&e.length>0||"请输入用户名",e=>/^[_a-zA-Z0-9]{3,16}$/.test(e)||"用户名必须在3-16个字符以内，只能包含字母、数字、下划线"]},null,8,["modelValue","rules"]),(0,r.Wm)(a,{filled:"",modelValue:(0,t.SU)(s).form.password,"onUpdate:modelValue":l[1]||(l[1]=e=>(0,t.SU)(s).form.password=e),type:"password",label:"输入您的密码",hint:"密码必须在6-30位之间","lazy-rules":"",rules:[e=>e&&e.length>0||"请输入密码",e=>/^([a-z]|[A-Z]|[\d~@#$%\*-\+=:,\\?\[\]\{}]){6,30}$/.test(e)||"密码必须在6-30位之间，且只能由字母、数字、特殊符号组成"]},null,8,["modelValue","rules"]),(0,r.Wm)(a,{filled:"",modelValue:(0,t.SU)(s).form.confirmPassword,"onUpdate:modelValue":l[2]||(l[2]=e=>(0,t.SU)(s).form.confirmPassword=e),type:"password",label:"确认密码",hint:"","lazy-rules":"",rules:[e=>e===(0,t.SU)(s).form.password||"两次输入的密码不一致"]},null,8,["modelValue","rules"])])),_:1},512)}}};var p=a(8689),c=a(4842),w=a(7518),_=a.n(w);const v=f,g=v;_()(f,"components",{QForm:p.Z,QInput:c.Z});var y=a(4663);const S={class:"row items-center q-gutter-sm"},b=(0,r._)("div",{class:"text-h6"},"电影目录",-1),U={class:"row items-center q-gutter-sm"},W=(0,r._)("div",{class:"text-h6"},"连续剧目录",-1),V={__name:"ScanFolderForm",setup(e){return(e,l)=>{const a=(0,r.up)("q-btn"),m=(0,r.up)("q-input"),o=(0,r.up)("q-form");return(0,r.wg)(),(0,r.j4)(o,{ref:"form",class:"q-gutter-md"},{default:(0,r.w5)((()=>[(0,r._)("div",S,[b,(0,r.Wm)(a,{icon:"add",color:"primary",dense:"",rounded:"",size:"xs",title:"新增",onClick:l[0]||(l[0]=e=>(0,t.SU)(s).form.movieFolder.push(""))})]),((0,r.wg)(!0),(0,r.iD)(r.HY,null,(0,r.Ko)((0,t.SU)(s).form.movieFolder,((e,l)=>((0,r.wg)(),(0,r.iD)("div",{key:l,class:"row items-center q-gutter-xs"},[(0,r.Wm)(m,{class:"col-11",filled:"",modelValue:(0,t.SU)(s).form.movieFolder[l],"onUpdate:modelValue":e=>(0,t.SU)(s).form.movieFolder[l]=e,label:`电影目录${l>0?l+1:""}`,hint:"输入需要扫描的电影文件夹目录","lazy-rules":"",rules:[e=>e&&e.length>0||"不能为空",(0,t.SU)(y.Vq)]},null,8,["modelValue","onUpdate:modelValue","label","rules"]),0!==l?((0,r.wg)(),(0,r.j4)(a,{key:0,icon:"remove",color:"negative",dense:"",rounded:"",size:"xs",title:"删除",onClick:e=>(0,t.SU)(s).form.movieFolder.splice(l,1)},null,8,["onClick"])):(0,r.kq)("",!0)])))),128)),(0,r._)("div",U,[W,(0,r.Wm)(a,{icon:"add",color:"primary",dense:"",rounded:"",size:"xs",title:"新增",onClick:l[1]||(l[1]=e=>(0,t.SU)(s).form.seriesFolder.push(""))})]),((0,r.wg)(!0),(0,r.iD)(r.HY,null,(0,r.Ko)((0,t.SU)(s).form.seriesFolder,((e,l)=>((0,r.wg)(),(0,r.iD)("div",{key:l,class:"row items-center q-gutter-xs"},[(0,r.Wm)(m,{class:"col-11",filled:"",modelValue:(0,t.SU)(s).form.seriesFolder[l],"onUpdate:modelValue":e=>(0,t.SU)(s).form.seriesFolder[l]=e,label:`连续剧目录${l>0?l+1:""}`,hint:"输入需要扫描的连续剧文件夹目录","lazy-rules":"",rules:[e=>e&&e.length>0||"不能为空",(0,t.SU)(y.Vq)]},null,8,["modelValue","onUpdate:modelValue","label","rules"]),0!==l?((0,r.wg)(),(0,r.j4)(a,{key:0,icon:"remove",color:"negative",dense:"",rounded:"",size:"xs",title:"删除",onClick:e=>(0,t.SU)(s).form.seriesFolder.splice(l,1)},null,8,["onClick"])):(0,r.kq)("",!0)])))),128))])),_:1},512)}}};var F=a(2165);const h=V,q=h;_()(V,"components",{QForm:p.Z,QBtn:F.Z,QInput:c.Z});var k=a(3822);const Z=(0,r._)("img",{src:"images/emby-logo.png",style:{height:"30px"}},null,-1),x=(0,r._)("img",{src:"images/jellyfin-logo.svg",style:{height:"30px"}},null,-1),Q=(0,r._)("img",{src:"images/plex-logo.svg",style:{height:"20px"}},null,-1),j={__name:"SelectMediaServerForm",setup(e){return(e,l)=>{const a=(0,r.up)("q-radio"),m=(0,r.up)("q-item-section"),o=(0,r.up)("q-item-label"),u=(0,r.up)("q-item"),n=(0,r.up)("q-list"),d=(0,r.up)("q-form"),i=(0,r.Q2)("ripple");return(0,r.wg)(),(0,r.j4)(d,{ref:"form"},{default:(0,r.w5)((()=>[(0,r.Wm)(n,{dense:""},{default:(0,r.w5)((()=>[(0,r.wy)(((0,r.wg)(),(0,r.j4)(u,{tag:"label"},{default:(0,r.w5)((()=>[(0,r.Wm)(m,{avatar:""},{default:(0,r.w5)((()=>[(0,r.Wm)(a,{modelValue:(0,t.SU)(s).form.mediaServer,"onUpdate:modelValue":l[0]||(l[0]=e=>(0,t.SU)(s).form.mediaServer=e),val:""},null,8,["modelValue"])])),_:1}),(0,r.Wm)(m,null,{default:(0,r.w5)((()=>[(0,r.Wm)(o,null,{default:(0,r.w5)((()=>[(0,r.Uk)("无")])),_:1})])),_:1})])),_:1})),[[i]]),(0,r.wy)(((0,r.wg)(),(0,r.j4)(u,{tag:"label"},{default:(0,r.w5)((()=>[(0,r.Wm)(m,{avatar:""},{default:(0,r.w5)((()=>[(0,r.Wm)(a,{modelValue:(0,t.SU)(s).form.mediaServer,"onUpdate:modelValue":l[1]||(l[1]=e=>(0,t.SU)(s).form.mediaServer=e),val:"emby"},null,8,["modelValue"])])),_:1}),(0,r.Wm)(m,null,{default:(0,r.w5)((()=>[(0,r.Wm)(o,null,{default:(0,r.w5)((()=>[Z])),_:1})])),_:1})])),_:1})),[[i]]),(0,r.wy)(((0,r.wg)(),(0,r.j4)(u,{tag:"label"},{default:(0,r.w5)((()=>[(0,r.Wm)(m,{avatar:""},{default:(0,r.w5)((()=>[(0,r.Wm)(a,{modelValue:(0,t.SU)(s).form.mediaServer,"onUpdate:modelValue":l[2]||(l[2]=e=>(0,t.SU)(s).form.mediaServer=e),val:"jellyfin"},null,8,["modelValue"])])),_:1}),(0,r.Wm)(m,null,{default:(0,r.w5)((()=>[(0,r.Wm)(o,null,{default:(0,r.w5)((()=>[x])),_:1})])),_:1})])),_:1})),[[i]]),(0,r.wy)(((0,r.wg)(),(0,r.j4)(u,{tag:"label"},{default:(0,r.w5)((()=>[(0,r.Wm)(m,{avatar:""},{default:(0,r.w5)((()=>[(0,r.Wm)(a,{modelValue:(0,t.SU)(s).form.mediaServer,"onUpdate:modelValue":l[3]||(l[3]=e=>(0,t.SU)(s).form.mediaServer=e),val:"plex"},null,8,["modelValue"])])),_:1}),(0,r.Wm)(m,null,{default:(0,r.w5)((()=>[(0,r.Wm)(o,null,{default:(0,r.w5)((()=>[Q])),_:1})])),_:1})])),_:1})),[[i]])])),_:1})])),_:1},512)}}};var C=a(7011),M=a(3414),I=a(2035),$=a(7991),z=a(2350),D=a(6489);const A=j,K=A;_()(j,"components",{QForm:p.Z,QList:C.Z,QItem:M.Z,QItemSection:I.Z,QRadio:$.Z,QItemLabel:z.Z}),_()(j,"directives",{Ripple:D.Z});var L=a(2323);const O={__name:"EmbySetupForm",setup(e){return(e,l)=>{const a=(0,r.up)("q-item-label"),m=(0,r.up)("q-item-section"),o=(0,r.up)("q-input"),u=(0,r.up)("q-item"),n=(0,r.up)("q-toggle"),d=(0,r.up)("q-list"),i=(0,r.up)("q-form"),f=(0,r.Q2)("ripple");return(0,r.wg)(),(0,r.j4)(i,{ref:"form"},{default:(0,r.w5)((()=>[(0,r.Wm)(d,{dense:""},{default:(0,r.w5)((()=>[(0,r.Wm)(u,null,{default:(0,r.w5)((()=>[(0,r.Wm)(m,null,{default:(0,r.w5)((()=>[(0,r.Wm)(a,null,{default:(0,r.w5)((()=>[(0,r.Uk)("Emby的内网URL")])),_:1})])),_:1}),(0,r.Wm)(m,null,{default:(0,r.w5)((()=>[(0,r.Wm)(o,{modelValue:(0,t.SU)(s).form.emby.url,"onUpdate:modelValue":l[0]||(l[0]=e=>(0,t.SU)(s).form.emby.url=e),standout:"",dense:"",rules:[e=>!!e||"不能为空",e=>e.match(/^https?:\/\/\w+(\.\w+)*(:[0-9]+)?\/?(\/[.\w]*)*$/)||"请输入正确的URL"]},null,8,["modelValue","rules"])])),_:1})])),_:1}),(0,r.Wm)(u,null,{default:(0,r.w5)((()=>[(0,r.Wm)(m,null,{default:(0,r.w5)((()=>[(0,r.Wm)(a,null,{default:(0,r.w5)((()=>[(0,r.Uk)("APIKey")])),_:1})])),_:1}),(0,r.Wm)(m,null,{default:(0,r.w5)((()=>[(0,r.Wm)(o,{modelValue:(0,t.SU)(s).form.emby.apiKey,"onUpdate:modelValue":l[1]||(l[1]=e=>(0,t.SU)(s).form.emby.apiKey=e),standout:"",dense:"",rules:[e=>!!e||"不能为空"]},null,8,["modelValue","rules"])])),_:1})])),_:1}),(0,r.Wm)(u,null,{default:(0,r.w5)((()=>[(0,r.Wm)(m,null,{default:(0,r.w5)((()=>[(0,r.Wm)(a,null,{default:(0,r.w5)((()=>[(0,r.Uk)("获取最多的剧集数量")])),_:1})])),_:1}),(0,r.Wm)(m,null,{default:(0,r.w5)((()=>[(0,r.Wm)(o,{modelValue:(0,t.SU)(s).form.emby.limitCount,"onUpdate:modelValue":l[2]||(l[2]=e=>(0,t.SU)(s).form.emby.limitCount=e),modelModifiers:{number:!0},standout:"",dense:"",rules:[e=>!!e||"不能为空",e=>/^\d+$/.test(e)||"必须是整数"]},null,8,["modelValue","rules"])])),_:1})])),_:1}),(0,r.wy)(((0,r.wg)(),(0,r.j4)(u,{tag:"label"},{default:(0,r.w5)((()=>[(0,r.Wm)(m,null,{default:(0,r.w5)((()=>[(0,r.Wm)(a,null,{default:(0,r.w5)((()=>[(0,r.Uk)("是否跳过已观看的")])),_:1})])),_:1}),(0,r.Wm)(m,null,{default:(0,r.w5)((()=>[(0,r.Wm)(n,{modelValue:(0,t.SU)(s).form.emby.skipWatched,"onUpdate:modelValue":l[3]||(l[3]=e=>(0,t.SU)(s).form.emby.skipWatched=e)},null,8,["modelValue"])])),_:1})])),_:1})),[[f]]),(0,r.wy)(((0,r.wg)(),(0,r.j4)(u,{class:(0,L.C_)({disabled:(0,t.SU)(s).form.emby.autoOrManual}),tag:"label"},{default:(0,r.w5)((()=>[(0,r.Wm)(m,null,{default:(0,r.w5)((()=>[(0,r.Wm)(a,null,{default:(0,r.w5)((()=>[(0,r.Uk)("自动匹配IMDB ID")])),_:1})])),_:1}),(0,r.Wm)(m,null,{default:(0,r.w5)((()=>[(0,r.Wm)(n,{modelValue:(0,t.SU)(s).form.emby.autoOrManual,"onUpdate:modelValue":l[4]||(l[4]=e=>(0,t.SU)(s).form.emby.autoOrManual=e),disable:(0,t.SU)(s).form.emby.autoOrManual},null,8,["modelValue","disable"])])),_:1})])),_:1},8,["class"])),[[f]])])),_:1})])),_:1},512)}}};var H=a(8886);const P=O,R=P;_()(O,"components",{QForm:p.Z,QList:C.Z,QItem:M.Z,QItemSection:I.Z,QItemLabel:z.Z,QInput:c.Z,QToggle:H.Z}),_()(O,"directives",{Ripple:D.Z});var Y=a(4290),B=a(1465),E=a(4184),T=a(1315),N=a(1988),G=a(8508);const J=(0,r._)("header",{class:"text-h4 q-pa-md text-center text-bold text-white"},"欢迎使用 ChineseSubFinder！",-1),X={class:"flex justify-center items-center q-pa-md q-mt-lg"},ee={style:{width:"800px"}},le={__name:"index",setup(e){i();const{startLoading:l}=(0,N.x)(),a=(0,m.tv)(),n=(0,t.iH)("1"),d=(0,k.CV)("adminAccountForm"),f=(0,k.CV)("scanFolderForm"),p=(0,k.CV)("mediaServerSettingForm"),c=(0,t.iH)(null),w=(0,t.iH)(!1),_=async()=>{let e=!0;"1"===n.value&&(e=await d.value.$refs.form.validate()),"2"===n.value&&(e=await f.value.$refs.form.validate()),e&&c.value.next()},v=(0,r.Fl)((()=>"emby"!==s.form.mediaServer?"3"===n.value:"31"===n.value)),y=async()=>{if(E.RF.value){const e=s.form.movieFolder.every((e=>e.startsWith("/media"))),l=s.form.seriesFolder.every((e=>e.startsWith("/media")));if(!e||!l)return void G.Z.create({title:"请修改相关配置后继续",html:!0,message:"软件运行在Docker中，请将电影和电视剧目录修改为 <b>/media</b> 下的目录，否则可能会因为权限问题导致无法正确的加载媒体库",persistent:!0,ok:"确定"})}let e=!0;if("emby"===s.form.mediaServer&&(e=await p.value.$refs.form.validate()),!e)return;w.value=!0;const r=(0,B.p$)(s.defaultSettings);r.user_info={username:s.form.username,password:s.form.password},r.common_settings={...r.common_settings,movie_paths:s.form.movieFolder,series_paths:s.form.seriesFolder},"emby"===s.form.mediaServer?r.emby_settings={...r.emby_settings,enable:!0,address_url:s.form.emby.url,api_key:s.form.emby.apiKey,max_request_video_number:s.form.emby.limitCount,skip_watched:s.form.emby.skipWatched,auto_or_manual:s.form.emby.autoOrManual,movie_paths_mapping:s.form.emby.movieFolderMap,series_paths_mapping:s.form.emby.seriesFolderMap}:r.advanced_settings.sub_name_formatter=T.uA;const[,t]=await o.Z.setup({settings:r});w.value=!1,null===t?(u.j.success("初始化完成"),await(0,E.C5)(),l(),a.push("/access/login")):u.j.error(t.message)};return(e,l)=>{const a=(0,r.up)("q-separator"),m=(0,r.up)("q-step"),o=(0,r.up)("q-form"),u=(0,r.up)("q-btn"),d=(0,r.up)("q-stepper-navigation"),i=(0,r.up)("q-stepper");return(0,r.wg)(),(0,r.iD)(r.HY,null,[(0,r.Wm)((0,t.SU)(Y.Z)),J,(0,r.Wm)(a),(0,r._)("main",X,[(0,r._)("div",ee,[(0,r.Wm)(i,{modelValue:n.value,"onUpdate:modelValue":l[1]||(l[1]=e=>n.value=e),ref_key:"stepper",ref:c,animated:"",vertical:"",flat:""},{navigation:(0,r.w5)((()=>[(0,r.Wm)(d,null,{default:(0,r.w5)((()=>[(0,t.SU)(v)?((0,r.wg)(),(0,r.j4)(u,{key:0,onClick:y,loading:w.value,color:"primary",label:"完成"},null,8,["loading"])):((0,r.wg)(),(0,r.j4)(u,{key:1,onClick:_,color:"primary",label:"下一步"})),n.value>"1"?((0,r.wg)(),(0,r.j4)(u,{key:2,flat:"",color:"deep-orange",onClick:l[0]||(l[0]=l=>e.$refs.stepper.previous()),label:"上一步",class:"q-ml-sm"})):(0,r.kq)("",!0)])),_:1})])),default:(0,r.w5)((()=>[(0,r.Wm)(m,{name:"1",prefix:"1",done:n.value>"1",title:"创建管理账号"},{default:(0,r.w5)((()=>[(0,r.Wm)((0,t.SU)(g),{ref:"adminAccountForm"},null,512)])),_:1},8,["done"]),(0,r.Wm)(m,{name:"2",prefix:"2",done:n.value>"2",title:"电影、连续剧目录设置"},{default:(0,r.w5)((()=>[(0,r.Wm)((0,t.SU)(q),{ref:"scanFolderForm"},null,512)])),_:1},8,["done"]),(0,r.Wm)(m,{name:"3",done:n.value>"3",prefix:"3",title:"选择媒体服务器"},{default:(0,r.w5)((()=>[(0,r.Wm)(o,{class:"q-gutter-md"},{default:(0,r.w5)((()=>[(0,r.Wm)((0,t.SU)(K))])),_:1})])),_:1},8,["done"]),"emby"===(0,t.SU)(s).form.mediaServer?((0,r.wg)(),(0,r.j4)(m,{key:0,name:"31",prefix:"4",title:"Emby设置"},{default:(0,r.w5)((()=>[(0,r.Wm)(o,{class:"q-gutter-md"},{default:(0,r.w5)((()=>[(0,r.Wm)((0,t.SU)(R),{ref_key:"mediaServerSettingForm",ref:p},null,512)])),_:1})])),_:1})):(0,r.kq)("",!0)])),_:1},8,["modelValue"])])])],64)}}};var ae=a(5869),re=a(3518),te=a(6552),me=a(118);const oe=le,ue=oe;_()(le,"components",{QSeparator:ae.Z,QStepper:re.Z,QStep:te.Z,QForm:p.Z,QStepperNavigation:me.Z,QBtn:F.Z})}}]);