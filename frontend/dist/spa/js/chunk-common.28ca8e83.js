"use strict";(globalThis["webpackChunkchinese_sub_finder_panel"]=globalThis["webpackChunkchinese_sub_finder_panel"]||[]).push([[64],{1084:(e,t,s)=>{s.d(t,{Z:()=>o});var a=s(2250),i=s.n(a),l=s(2306);class n extends l.Z{constructor(...e){super(...e),i()(this,"login",(e=>this.http("/login",e,"POST"))),i()(this,"logout",(e=>this.http("/logout",e,"POST")))}}const o=new n},304:(e,t,s)=>{s.d(t,{Z:()=>o});var a=s(2250),i=s.n(a),l=s(2306);class n extends l.Z{constructor(...e){super(...e),i()(this,"setup",(e=>this.http("/setup",e,"POST"))),i()(this,"getDefaultSettings",(e=>this.http("/def-settings",e))),i()(this,"checkProxy",(e=>this.http("/check-proxy",e,"POST",{timeout:12e4}))),i()(this,"checkPath",(e=>this.http("/check-path",e,"POST"))),i()(this,"checkEmbyPath",(e=>this.http("/check-emby-path",e,"POST"))),i()(this,"checkEmbyServer",(e=>this.http("/check-emby-settings",e,"POST"))),i()(this,"checkTmdbApiKey",(e=>this.http("/check-tmdb-api-settings",e,"POST")))}}const o=new n},8486:(e,t,s)=>{s.d(t,{I:()=>o,Z:()=>u});var a=s(2250),i=s.n(a),l=s(6833),n=s(8298);class o{constructor(){i()(this,"BaseUrl",n.Z.CSF_SUBTITLES_API_URL),i()(this,"prefix","/share-sub/v1"),i()(this,"searchMovie",(e=>this.http(`${this.prefix}/search-movie`,e,"POST"))),i()(this,"searchTvEps",(e=>this.http(`${this.prefix}/search-tv-eps`,e,"POST"))),i()(this,"searchTvSeasonPackage",(e=>this.http(`${this.prefix}/search-tv-season-package`,e,"POST"))),i()(this,"searchTvSeasonPackageId",(e=>this.http(`${this.prefix}/search-tv-season-package-id`,e,"POST"))),i()(this,"getDownloadUrl",(e=>this.http(`${this.prefix}/get-dl-url`,e,"POST")))}http(e,...t){return(0,l.l)(`${this.BaseUrl}${e}`,...t)}}const u=new o},1684:(e,t,s)=>{s.d(t,{Z:()=>o});var a=s(2250),i=s.n(a),l=s(8486);class n extends l.I{constructor(...e){super(...e),i()(this,"prefix","/user-share-sub/v1"),i()(this,"getUploadUrl",(e=>this.http(`${this.prefix}/generate-tmp-upload-url`,e,"POST"))),i()(this,"setUploadSuccess",(e=>this.http(`${this.prefix}/tmp-upload-done`,e,"POST"))),i()(this,"setUploadSuccessForTv",(e=>this.http(`${this.prefix}/mark-upload-tv-subs-done`,e,"POST")))}}const o=new n},7493:(e,t,s)=>{s.d(t,{Z:()=>u});var a=s(2250),i=s.n(a),l=s(4276),n=s(2306);class o extends n.Z{constructor(...e){super(...e),i()(this,"getRefreshStatus",(()=>this.http("/v1/video/list/refresh-status"))),i()(this,"refreshLibrary",(()=>this.http("/v1/video/list/refresh_main_list",{},"POST"))),i()(this,"getList",(()=>this.http("/v1/video/list/video_main_list"))),i()(this,"getImdbId",(e=>this.http("/v1/preview/video_f_path_2_imdb_info",e,"POST"))),i()(this,"downloadSubtitle",(e=>this.http("/v1/video/list/add",e,"POST"))),i()(this,"getMoviePoster",(e=>this.http("/v1/video/list/movie_poster",e,"POST"))),i()(this,"getTvPoster",(e=>this.http("/v1/video/list/series_poster",e,"POST"))),i()(this,"getSkipInfo",(e=>this.http("/v1/video/list/scan_skip_info",e,"POST"))),i()(this,"setSkipInfo",(e=>this.http("/v1/video/list/scan_skip_info",e,"PUT"))),i()(this,"getMovieDetail",(e=>this.http("/v1/video/list/one_movie_subs",e,"POST"))),i()(this,"getTvDetail",(e=>this.http("/v1/video/list/one_series_subs",e,"POST"))),i()(this,"getSubtitleQueueStatus",(e=>this.http("/v1/subtitles/is_manual_upload_2_local_in_queue",e,"POST"))),i()(this,"uploadSubtitle",(e=>this.http("/v1/subtitles/manual_upload_2_local",e,"POST",{headers:{"Content-Type":"multipart/form-data"}}))),i()(this,"refreshMediaServerSubList",(()=>this.http("/v1/subtitles/refresh_media_server_sub_list",{},"POST"))),i()(this,"getSubTitleQueueList",(()=>this.http("/v1/subtitles/list_manual_upload_2_local_job"))),i()(this,"getSearchSubtitleInfo",(e=>this.http("/v1/preview/search_other_web",e,"POST"))),i()(this,"cleanAllPreviewJobData",(()=>this.http("/v1/preview/clean_up",{},"POST"))),i()(this,"getVideoM3u8",(e=>this.http(`/v1/preview/playlist/${(0,l.cv)(encodeURIComponent(e))}`))),i()(this,"getUploadInfo",(e=>this.http("/v1/subtitles/get_generate_upload_url_info",e,"POST")))}}const u=new o},5355:(e,t,s)=>{s.d(t,{R:()=>n});var a=s(6395),i=s(1959),l=s(4972);const n=(e,t=2e3)=>{let s=a.Z.getItem(e)||0;const n=t,o=(0,i.iH)(0),u=(0,i.iH)(!1);(0,l.Z)((()=>{const e=Math.ceil((s+n-Date.now())/1e3);o.value=e>0?e:0}),100);const r=()=>{const t=Date.now();return!(t-s<n)&&(s=t,a.Z.set(e,t),!0)},p=async()=>{u.value=!0;while(!r())await new Promise((e=>{setTimeout(e,100)}));u.value=!1};return{checkRequestReady:r,waitRequestReady:p,countdownLoading:u,nextRequestCountdownSecond:o}}},2848:(e,t,s)=>{s.d(t,{Z:()=>n});var a=s(5936),i=s(3673);const l=(e,t)=>{const s=(...e)=>{t(...e)};a.Z.on(e,s),(0,i.Jd)((()=>{a.Z.off(e,s)}))},n=l},4764:(e,t,s)=>{s.d(t,{a:()=>a});const a={0:"未知",1:"简中",2:"繁中",3:"简英",4:"繁英",5:"英文",6:"日语",7:"简日",8:"繁日",9:"韩语",10:"简韩",11:"繁韩"}},1315:(e,t,s)=>{s.d(t,{$y:()=>g,EH:()=>k,H8:()=>_,V2:()=>b,Vu:()=>v,b2:()=>f,h1:()=>n,ho:()=>r,j3:()=>c,k4:()=>p,uA:()=>u,uN:()=>S,y0:()=>o});const a=0,i=1,l=2,n={[a]:"自动",[i]:"srt",[l]:"ass"},o=0,u=1,r=2,p={[o]:"Emby格式",[u]:"常规格式",[r]:"与视频名称一致"},c=0,d=1,v={[c]:"UTF-8",[d]:"GBK"},m=0,h=1,g={[m]:"转简体",[h]:"轉繁體"},_={xunlei:"http://sub.xmp.sandai.net:8000/subxl/%s.json",shooter:"https://www.shooter.cn/api/subapi.php",subhd:"https://subhd.tv",zimuku:"https://zimuku.org",assrt:"https://api.assrt.net/v1",a4k:"https://www.a4k.net"},w="http",y="socks5",b={[w]:"HTTP",[y]:"SOCKS5"},f=0,k=1,S={[f]:"电影",[k]:"电视剧"}},4739:(e,t,s)=>{s.d(t,{Dr:()=>Z,ET:()=>w,FC:()=>_,Gr:()=>c,RD:()=>D,eB:()=>S,qb:()=>T,yX:()=>q});var a=s(1959),i=s(3673),l=s(7493),n=s(9897),o=s(6674),u=s(8298),r=s(6395),p=s(9238);const c=e=>u.Z.BACKEND_URL+e.split(/\/|\\/).join("/"),d=((0,a.iH)(r.Z.getItem("coverRule")??"poster.jpg"),(0,a.iH)([])),v=(0,a.iH)([]),m=(0,i.Fl)((()=>d.value.map((e=>({...e}))))),h=(0,i.Fl)((()=>v.value.map((e=>({...e}))))),g=(0,a.iH)(null),_=(0,a.iH)([]),w=(0,i.Fl)((()=>"running"===g.value));let y=null;const b=async()=>{const[e]=await l.Z.getRefreshStatus();g.value=e.status},f=async()=>{const[e,t]=await l.Z.getList();null!==t?n.j.error(t.message):(d.value=e.movie_infos_v2,v.value=e.season_infos_v2)},k=async()=>{g.value=null,await b(),y=setInterval((()=>{b()}),1e3),await(0,o.C4)(g).toBe("stopped"),clearInterval(y),y=null,await f()},S=async()=>{const[,e]=await l.Z.refreshLibrary();null!==e?n.j.error(e.message):(await k(),n.j.success("更新缓存成功"))},Z=async()=>{const[e]=await l.Z.getSubTitleQueueList();_.value=e.jobs},q=()=>{(0,p.rV)();const e=setInterval((()=>{Z()}),5e3);return(0,i.bv)((()=>{f(),b(),Z(),k()})),(0,i.Jd)((()=>{clearInterval(y),clearInterval(e)})),{movies:m,tvs:h,refreshLibrary:S,refreshCacheLoading:w}},T=async e=>{const t=new FormData;t.append("video_f_path",e);const s=c(e),a=await fetch(s);if(!a.ok)return void n.j.error("获取字幕文件失败");const i=await a.blob(),o=new File([i],e.split(/\/|\\/).pop());t.append("file",o),await l.Z.uploadSubtitle(t),n.j.success("已提交时间轴校准",{timeout:3e3}),await Z()},D=async e=>{const[t]=await l.Z.getSkipInfo({video_skip_infos:[e]});return!!t.is_skips?.[0]}},9238:(e,t,s)=>{s.d(t,{OP:()=>_,_G:()=>Z,Fx:()=>y,g3:()=>S,i6:()=>k,rV:()=>f});s(3610);var a=s(1959),i=s(3673),l=s(2250),n=s.n(l),o=s(2306);class u extends o.Z{constructor(...e){super(...e),n()(this,"get",(e=>this.http("/v1/settings",e))),n()(this,"patchUpdate",(e=>this.http("/v1/settings",e,"PATCH"))),n()(this,"update",(e=>this.http("/v1/settings",e,"PUT")))}}const r=new u;var p=s(9897),c=s(1465),d=s(1988),v=s(4184),m=s(8508),h=s(2170);const{startLoading:g}=(0,d.x)(),_=(0,a.qj)({}),w=()=>{const e=(e,t)=>e.reduce(((e,s)=>(Object.keys(t).includes(s)?e[s]=t[s]:e[s]="",e)),{}),t=h.K.settings?.common_settings,s=h.K.settings.emby_settings;s.movie_paths_mapping=e(t.movie_paths,s.movie_paths_mapping||{}),s.series_paths_mapping=e(t.series_paths,s.series_paths_mapping||{})};(0,i.YP)((()=>h.K.settings),(()=>{w(),Object.assign(_,(0,c.p$)(h.K.settings))}));const y=()=>{Object.assign(_,(0,c.p$)(h.K.settings))},b=async()=>{const[e,t]=await r.get();null===t?h.K.settings=e:p.j.error(t.message)},f=()=>{b()},k=(0,a.iH)(!1),S=async()=>{if(v.RF.value){const e=_.common_settings.movie_paths.every((e=>e.startsWith("/media"))),t=_.common_settings.series_paths.every((e=>e.startsWith("/media")));if(!e||!t)return void m.Z.create({title:"请修改相关配置后继续",html:!0,message:"软件运行在Docker中，请将基础设置中的电影和电视剧目录修改为 <b>/media</b> 下的目录，否则可能会因为权限问题导致无法正确的加载媒体库",persistent:!0,ok:"确定"})}k.value=!0;const[,e]=await r.update(_);k.value=!1,null===e?(h.K.settings={...h.K.settings,...(0,c.p$)(_)},p.j.success("保存成功"),g()):p.j.error(e.message)},Z=(e=!1)=>{const t=(0,c.p$)(h.K.settings);return e||(delete t.user_info,delete t.advanced_settings.proxy_settings,delete t.common_settings.threads,delete t.emby_settings.api_key,delete t.emby_settings.address_url,delete t.experimental_function.api_key_settings),t}},1465:(e,t,s)=>{s.d(t,{fE:()=>l,m$:()=>i,p$:()=>a});const a=e=>JSON.parse(JSON.stringify(e)),i=()=>{const e=new URLSearchParams;e.append("template","----bug----.md"),window.open(`https://github.com/ChineseSubFinder/ChineseSubFinder/issues/new?${e.toString()}`,"_blank")},l=e=>!!e&&("tt00000"!==e&&/^tt\d{7,8}$/.test(e))},9897:(e,t,s)=>{s.d(t,{j:()=>l});var a=s(6417);const i=500,l={success(e,t={}){a.Z.create({message:e,icon:"check_circle",position:"top",color:"positive",timeout:i,...t})},warn(e,t={}){a.Z.create({message:e,icon:"warning",position:"top",color:"warning",timeout:i,...t})},info(e,t={}){a.Z.create({message:e,icon:"info",position:"top",color:"info",timeout:i,...t})},error(e,t={}){a.Z.create({message:e,icon:"error",position:"top",color:"negative",timeout:2e3,...t})}}},4663:(e,t,s)=>{s.d(t,{MA:()=>l,Vq:()=>i});var a=s(304);const i=e=>new Promise((t=>{a.Z.checkPath({path:e}).then((([e,s])=>{t(!!e?.valid||(s?.message||"目录不可用，请确保目录存在并且拥有权限"))}))})),l=e=>/(@(annually|yearly|monthly|weekly|daily|hourly|reboot))|(@every (\d+(ns|us|µs|ms|s|m|h))+)|((((\d+,)+\d+|(\d+(\/|-)\d+)|\d+|\*) ?){5,7})/.test(e)||"格式不正确"},1244:(e,t,s)=>{s.d(t,{Z:()=>c});var a=s(3673),i=s(1914),l=s(9897);const n={__name:"CopyToClipboardBtn",props:{text:String,getText:Function},setup(e){const t=e,s=async()=>{let e=null;e="function"===typeof t.getText?(0,i.Z)(t.getText()):(0,i.Z)(t.text),await e,l.j.success("已复制到剪贴板")};return(e,t)=>{const i=(0,a.up)("q-btn");return(0,a.wg)(),(0,a.j4)(i,(0,a.dG)({flat:"",dense:"",icon:"content_copy",color:"grey-8",onClick:s},e.$attrs),null,16)}}};var o=s(2165),u=s(7518),r=s.n(u);const p=n,c=p;r()(n,"components",{QBtn:o.Z})},768:(e,t,s)=>{s.d(t,{Z:()=>h});var a=s(3673),i=s(2323),l=s(1959),n=s(2848),o=s(120),u=s.n(o);const r={class:"text-bold text-center"},p={__name:"SubtitleBestApiLimitBanner",setup(e){const t=(0,l.iH)(null);return(0,n.Z)("subtitle-best-api-limit-info",(e=>{t.value=e})),(e,s)=>{const n=(0,a.up)("q-banner");return t.value?((0,a.wg)(),(0,a.j4)(n,{key:0,dense:"",class:(0,i.C_)(["bg-grey-3",{"bg-negative":t.value.dailyCount>=t.value.dayliLimit,"bg-warning":t.value.dailyCount/t.value.dayliLimit>.8}])},{default:(0,a.w5)((()=>[(0,a._)("div",r," 每日限制："+(0,i.zw)(t.value.dailyCount)+" / "+(0,i.zw)(t.value.dailyLimit)+"，ApiKey 过期时间："+(0,i.zw)((0,l.SU)(u()).unix(t.value.expireTime).format("YYYY-MM-DD HH:mm:ss")),1)])),_:1},8,["class"])):(0,a.kq)("",!0)}}};var c=s(5607),d=s(7518),v=s.n(d);const m=p,h=m;v()(p,"components",{QBanner:c.Z})},4290:(e,t,s)=>{s.d(t,{Z:()=>d});var a=s(3673);const i=e=>((0,a.dD)("data-v-6463611e"),e=e(),(0,a.Cn)(),e),l={class:"area"},n=i((()=>(0,a._)("ul",{class:"circles"},[(0,a._)("li"),(0,a._)("li"),(0,a._)("li"),(0,a._)("li"),(0,a._)("li"),(0,a._)("li"),(0,a._)("li"),(0,a._)("li"),(0,a._)("li"),(0,a._)("li")],-1))),o=[n];function u(e,t){return(0,a.wg)(),(0,a.iD)("div",l,o)}var r=s(4260);const p={},c=(0,r.Z)(p,[["render",u],["__scopeId","data-v-6463611e"]]),d=c},9608:(e,t,s)=>{s.d(t,{Z:()=>W});var a=s(3673),i=s(2323),l=s(1959),n=s(1405),o=s.n(n),u=s(4276),r=s(7493),p=s(629),c=s.n(p);const d={__name:"Artplayer",props:{option:{type:Object,required:!0}},emits:["get-instance"],setup(e,{emit:t}){const s=e,i=(0,l.iH)(null),n=(0,l.iH)(null),o=()=>{i.value=new(c())({...s.option,container:n.value}),(0,a.Y3)((()=>{t("get-instance",i.value)}))};return(0,a.m0)((()=>s.option),(()=>{i.value?.destroy(),o()})),(0,a.bv)((()=>{o()})),(0,a.Jd)((()=>{i.value?.destroy()})),(e,t)=>((0,a.wg)(),(0,a.iD)("div",{ref_key:"artRef",ref:n},null,512))}},v=d,m=v;var h=s(8298),g=s(8825),_=s(4739),w=s(9560);const y={class:"text-bold"},b={key:0,class:"q-pa-md justify-center"},f={key:1,class:"row items-center"},k={class:"text-h6 text-red"},S={__name:"BtnDialogPreviewVideo",props:{path:String,onBtnClick:Function,subtitleUrlList:{type:Array,default:()=>[]},subtitleType:String},setup(e){const t=e,s=(0,g.Z)(),n=(0,l.iH)(!1),p=(0,l.iH)(null),c=(0,l.iH)(null),d=(0,l.iH)(null),v=async()=>{t.onBtnClick?t.onBtnClick((e=>{e&&(n.value=!0)})):n.value=!0},S=e=>{p.value=e},Z=()=>{s.dialog({title:"选择字幕",style:"width: 800px",options:{type:"radio",model:c.value,items:t.subtitleUrlList.map((e=>({label:e,value:e})))},cancel:!0,persistent:!0}).onOk((async e=>{c.value=e,p.value.subtitle.switch((0,_.Gr)(e))}))},q=(0,a.Fl)((()=>{const e={autoplay:!0,autoSize:!0,url:`${h.Z.BACKEND_URL}/v1/preview/playlist/${(0,u.cv)(encodeURIComponent(t.path))}`,subtitle:{url:c.value.startsWith("blob")?c.value:(0,_.Gr)(c.value)},type:"m3u8",customType:{m3u8(e,t){if(o().isSupported()){const s=new(o());s.config.xhrSetup=e=>{const{accessToken:t}=w.K;e.setRequestHeader("Authorization",`Bearer ${t}`)},s.loadSource(t),s.attachMedia(e)}else e.canPlayType("application/vnd.apple.mpegurl")&&(e.src=t)}},controls:0===t.subtitleUrlList.length?[]:[{disable:!1,name:"button",index:10,position:"right",html:"选择字幕",tooltip:"选择字幕",style:{color:"red"},click(){Z()},mounted(){}}]};return t.subtitleType&&(e.subtitle.type=t.subtitleType),e})),T=async()=>{c.value=t.subtitleUrlList?.[0];const[e,s]=await r.Z.getVideoM3u8(t.path);d.value=e||s},D=()=>{d.value=null,r.Z.cleanAllPreviewJobData()};return(t,s)=>{const o=(0,a.up)("q-btn"),u=(0,a.up)("q-space"),r=(0,a.up)("q-bar"),p=(0,a.up)("q-icon"),h=(0,a.up)("q-card-section"),g=(0,a.up)("q-card"),_=(0,a.up)("q-dialog"),w=(0,a.Q2)("close-popup");return(0,a.wg)(),(0,a.iD)(a.HY,null,[(0,a.Wm)(o,(0,a.dG)({color:"primary",icon:"smart_display",flat:"",dense:""},t.$attrs,{onClick:v,title:"预览"}),null,16),(0,a.Wm)(_,{modelValue:n.value,"onUpdate:modelValue":s[0]||(s[0]=e=>n.value=e),persistent:"","transition-show":"slide-up","transition-hide":"slide-down",maximized:"",onBeforeShow:T,onBeforeHide:D},{default:(0,a.w5)((()=>[(0,a.Wm)(g,{class:"column"},{default:(0,a.w5)((()=>[(0,a.Wm)(r,null,{default:(0,a.w5)((()=>[(0,a._)("div",y,(0,i.zw)(e.path.split(/\/|\\/).pop()),1),(0,a.Wm)(u),(0,a.wy)((0,a.Wm)(o,{dense:"",flat:"",icon:"close",title:"关闭"},null,512),[[w]])])),_:1}),d.value?((0,a.wg)(),(0,a.j4)(h,{key:0,class:"col column items-center justify-center no-wrap"},{default:(0,a.w5)((()=>[void 0===d.value.message?((0,a.wg)(),(0,a.iD)("div",b,[(0,a._)("div",{class:"text-bold q-mb-sm cursor-pointer",onClick:Z}," 字幕："+(0,i.zw)(c.value?.split(/\/|\\/).pop()),1),(0,a.Wm)((0,l.SU)(m),{option:(0,l.SU)(q),style:{height:"80vh",width:"calc(1920 / 1080 * 80vh)"},onGetInstance:S},null,8,["option"])])):((0,a.wg)(),(0,a.iD)("div",f,[(0,a.Wm)(p,{name:"error",size:"4rem",color:"red"}),(0,a._)("div",k,(0,i.zw)(d.value.message),1)]))])),_:1})):(0,a.kq)("",!0)])),_:1})])),_:1},8,["modelValue"])],64)}}};var Z=s(2165),q=s(6778),T=s(151),D=s(846),x=s(2025),U=s(5589),H=s(4554),j=s(677),P=s(7518),B=s.n(P);const I=S,W=I;B()(S,"components",{QBtn:Z.Z,QDialog:q.Z,QCard:T.Z,QBar:D.Z,QSpace:x.Z,QCardSection:U.Z,QIcon:H.Z}),B()(S,"directives",{ClosePopup:j.Z})},3718:(e,t,s)=>{s.d(t,{Z:()=>L});var a=s(3673),i=s(1959),l=(s(3610),s(2323)),n=s(7493),o=s(9897);const u={style:{"min-height":"300px"}},r=(0,a._)("div",{class:"text-grey"},"点击关键字跳转到网站搜索",-1),p={class:"row q-gutter-sm"},c=["href"],d={__name:"SearchPanelManual",props:{path:String,isMovie:{type:Boolean,default:!1}},setup(e){const t=e,s=(0,i.iH)(null),d=async()=>{const[e,a]=await n.Z.getSearchSubtitleInfo({video_f_path:t.path,is_movie:t.isMovie});null!==a&&o.j.error(a.message),s.value=e},v=e=>{const t=/https?:\/\/([^/]+)/,s=t.exec(e);return s[1]},m=(e,t)=>e.includes("%s")?e.replace("%s",encodeURIComponent(t)):e+encodeURIComponent(t);return(0,a.bv)((()=>{d()})),(e,t)=>{const i=(0,a.up)("q-item-section"),n=(0,a.up)("q-badge"),o=(0,a.up)("q-item"),d=(0,a.up)("q-list"),h=(0,a.up)("q-spinner"),g=(0,a.up)("q-inner-loading");return(0,a.wg)(),(0,a.iD)("div",u,[r,(0,a.Wm)(d,{separator:""},{default:(0,a.w5)((()=>[((0,a.wg)(!0),(0,a.iD)(a.HY,null,(0,a.Ko)(s.value?.search_url,(e=>((0,a.wg)(),(0,a.j4)(o,{key:e},{default:(0,a.w5)((()=>[(0,a.Wm)(i,{top:"",side:"",style:{width:"200px"},class:"text-bold text-black"},{default:(0,a.w5)((()=>[(0,a.Uk)((0,l.zw)(v(e)),1)])),_:2},1024),(0,a.Wm)(i,null,{default:(0,a.w5)((()=>[(0,a._)("div",p,[((0,a.wg)(!0),(0,a.iD)(a.HY,null,(0,a.Ko)(s.value?.key_words,(t=>((0,a.wg)(),(0,a.iD)("a",{key:t,href:m(e,t),target:"_blank",style:{"text-decoration":"none"}},[(0,a.Wm)(n,{class:"cursor-pointer",color:"secondary",title:"点击跳转到网站搜索"},{default:(0,a.w5)((()=>[(0,a.Uk)((0,l.zw)(t),1)])),_:2},1024)],8,c)))),128))])])),_:2},1024)])),_:2},1024)))),128))])),_:1}),(0,a.Wm)(g,{showing:!s.value},{default:(0,a.w5)((()=>[(0,a.Wm)(h,{size:"50px",color:"primary"})])),_:1},8,["showing"])])}}};var v=s(7011),m=s(3414),h=s(2035),g=s(9721),_=s(6941),w=s(9400),y=s(7518),b=s.n(y);const f=d,k=f;b()(d,"components",{QList:v.Z,QItem:m.Z,QItemSection:h.Z,QBadge:g.Z,QInnerLoading:_.Z,QSpinner:w.Z});var S=s(8423),Z=s(3280);const q={class:"row justify-between items-center"},T=(0,a._)("div",{class:"text-h6 text-grey-8"},"字幕搜索",-1),D=(0,a._)("div",{class:"text-warning"},"* 下载字幕包是在浏览器端进行处理的，下载过程中请不要关闭页面",-1),x={__name:"BtnDialogSearchSubtitle",props:{path:String,isMovie:{type:Boolean,default:!1},searchPackage:{type:Boolean,default:!1},season:{type:Number},episode:{type:Number},packageEpisodes:{type:Array}},setup(e){const t=(0,i.iH)(!1),s=(0,i.iH)("csf");return(i,l)=>{const n=(0,a.up)("q-btn"),o=(0,a.up)("q-card-section"),u=(0,a.up)("q-separator"),r=(0,a.up)("q-tab"),p=(0,a.up)("q-tabs"),c=(0,a.up)("q-tab-panel"),d=(0,a.up)("q-tab-panels"),v=(0,a.up)("q-card"),m=(0,a.up)("q-dialog");return(0,a.wg)(),(0,a.iD)(a.HY,null,[(0,a.Wm)(n,(0,a.dG)({color:"primary",icon:"search",size:"sm",flat:"",dense:""},i.$attrs,{onClick:l[0]||(l[0]=e=>t.value=!0),title:"字幕搜索"}),null,16),(0,a.Wm)(m,{modelValue:t.value,"onUpdate:modelValue":l[6]||(l[6]=e=>t.value=e),"transition-show":"slide-up","transition-hide":"slide-down",persistent:""},{default:(0,a.w5)((()=>[(0,a.Wm)(v,{style:{"min-width":"70vw"}},{default:(0,a.w5)((()=>[(0,a.Wm)(o,null,{default:(0,a.w5)((()=>[(0,a._)("div",q,[T,(0,a.Wm)(n,{icon:"close",flat:"",round:"",dense:"",onClick:l[1]||(l[1]=e=>t.value=!1)})]),D])),_:1}),(0,a.Wm)(u),e.searchPackage?((0,a.wg)(),(0,a.iD)(a.HY,{key:1},[(0,a.Wm)(p,{modelValue:s.value,"onUpdate:modelValue":l[4]||(l[4]=e=>s.value=e),dense:"","active-color":"primary","indicator-color":"primary",align:"justify","narrow-indicator":"",style:{display:"inline-block"}},{default:(0,a.w5)((()=>[(0,a.Wm)(r,{name:"csf",label:"Subtitle.Best API"})])),_:1},8,["modelValue"]),(0,a.Wm)(d,{modelValue:s.value,"onUpdate:modelValue":l[5]||(l[5]=e=>s.value=e),animated:"","keep-alive":""},{default:(0,a.w5)((()=>[(0,a.Wm)(c,{name:"csf"},{default:(0,a.w5)((()=>[(0,a.Wm)(Z.Z,{episodes:e.packageEpisodes},null,8,["episodes"])])),_:1}),(0,a.Wm)(c,{name:"csf-share"},{default:(0,a.w5)((()=>[(0,a.Wm)(Z.Z,{episodes:e.packageEpisodes,"use-user-share-api":""},null,8,["episodes"])])),_:1})])),_:1},8,["modelValue"])],64)):((0,a.wg)(),(0,a.iD)(a.HY,{key:0},[(0,a.Wm)(p,{modelValue:s.value,"onUpdate:modelValue":l[2]||(l[2]=e=>s.value=e),dense:"","active-color":"primary","indicator-color":"primary",align:"justify","narrow-indicator":"",style:{display:"inline-block"}},{default:(0,a.w5)((()=>[(0,a.Wm)(r,{name:"csf",label:"Subtitle.Best API"}),(0,a.Wm)(r,{name:"manual",label:"手动搜索"})])),_:1},8,["modelValue"]),(0,a.Wm)(d,{modelValue:s.value,"onUpdate:modelValue":l[3]||(l[3]=e=>s.value=e),animated:"","keep-alive":""},{default:(0,a.w5)((()=>[(0,a.Wm)(c,{name:"csf"},{default:(0,a.w5)((()=>[(0,a.Wm)(S.Z,{path:e.path,"is-movie":e.isMovie,season:e.season,episode:e.episode},null,8,["path","is-movie","season","episode"])])),_:1}),(0,a.Wm)(c,{name:"manual"},{default:(0,a.w5)((()=>[(0,a.Wm)(k,{"is-movie":e.isMovie,path:e.path},null,8,["is-movie","path"])])),_:1})])),_:1},8,["modelValue"])],64))])),_:1})])),_:1},8,["modelValue"])],64)}}};var U=s(2165),H=s(6778),j=s(151),P=s(5589),B=s(5869),I=s(7547),W=s(3269),C=s(5906),Q=s(6602);const O=x,L=O;b()(x,"components",{QBtn:U.Z,QDialog:H.Z,QCard:j.Z,QCardSection:P.Z,QSeparator:B.Z,QTabs:I.Z,QTab:W.Z,QTabPanels:C.Z,QTabPanel:Q.Z})},8534:(e,t,s)=>{s.d(t,{Z:()=>g});var a=s(3673),i=s(8880),l=s(7493),n=s(9897),o=s(8825),u=s(1959),r=s(2848),p=s(4739);const c={__name:"BtnIgnoreVideo",props:{path:String,videoType:Number},setup(e){const t=e,s=(0,o.Z)(),c=(0,u.iH)(null),d=async()=>{c.value=await(0,p.RD)({video_type:t.videoType,physical_video_file_full_path:t.path,is_bluray:!1,is_skip:!0})},v=async()=>{s.dialog({title:"提示",message:c.value?"确定要解锁该视频吗？":"确定要锁定该视频，不进行字幕下载吗？",cancel:!0,persistent:!0}).onOk((async()=>{const[e]=await l.Z.setSkipInfo({video_skip_infos:[{video_type:t.videoType,physical_video_file_full_path:t.path,is_bluray:!1,is_skip:!c.value}]});e&&(n.j.success("操作成功"),d())}))};return(0,r.Z)(`refresh-skip-status-${t.path}`,(e=>{void 0!==e?c.value=e:d()})),(0,a.bv)((()=>{d()})),(e,t)=>{const s=(0,a.up)("q-btn");return c.value?((0,a.wg)(),(0,a.j4)(s,(0,a.dG)({key:0,color:"warning",round:"",flat:"",dense:"",icon:"lock",onClick:[t[0]||(t[0]=(0,i.iM)((()=>{}),["stop"])),v],title:"当前视频已锁定，不进行字幕下载"},e.$attrs),null,16)):((0,a.wg)(),(0,a.j4)(s,(0,a.dG)({key:1,color:"grey",round:"",flat:"",dense:"",icon:"lock",onClick:[t[1]||(t[1]=(0,i.iM)((()=>{}),["stop"])),v],title:"点击锁定视频，不进行字幕下载"},e.$attrs),null,16))}}};var d=s(2165),v=s(7518),m=s.n(v);const h=c,g=h;m()(c,"components",{QBtn:d.Z})},7771:(e,t,s)=>{s.d(t,{Z:()=>v});var a=s(3673),i=s(1959),l=s(4739),n=s(8825);const o={__name:"BtnLibraryRefresh",setup(e){const t=(0,n.Z)(),s=()=>{t.dialog({title:"更新缓存",message:"刷新缓存并不会自动提交下载字幕的任务，仅仅是方便手动选择一个视频去下载字幕。这个是一个长耗时任务，请在有手动的需求下操作。暂时不支持动态更新缓存，需要手动执行完整的缓存刷新操作。",persistent:!0,ok:"确定",cancel:"取消"}).onOk((()=>{(0,l.eB)()})).onCancel((()=>{}))};return(e,t)=>{const n=(0,a.up)("q-spinner-hourglass"),o=(0,a.up)("q-btn");return(0,a.wg)(),(0,a.j4)(o,{label:"更新缓存",color:"primary",icon:"refresh",onClick:s,loading:(0,i.SU)(l.ET)},{loading:(0,a.w5)((()=>[(0,a.Wm)(n,{class:"on-left"}),(0,a.Uk)(" 更新缓存中... ")])),_:1},8,["loading"])}}};var u=s(2165),r=s(3282),p=s(7518),c=s.n(p);const d=o,v=d;c()(o,"components",{QBtn:u.Z,QSpinnerHourglass:r.Z})},6960:(e,t,s)=>{s.d(t,{Z:()=>h});var a=s(3673),i=s(1959),l=s(8825),n=s(7493),o=s(9897),u=s(2170);const r={__name:"BtnMediaServerSubtitleRefresh",setup(e){const t=(0,l.Z)(),s=(0,a.Fl)((()=>u.K.settings?.emby_settings.enable)),r=()=>{t.dialog({title:"更新媒体服务器字幕",message:"此操作会刷新最近的10000个视频的字幕，可能需要一段时间才能生效。提交后会触发媒体服务器的刷新，异步操作，无需频繁点击触发。服务器刷新生效也需要看各自的媒体文件数量。",persistent:!0,ok:"确定",cancel:"取消"}).onOk((async()=>{const[,e]=await n.Z.refreshMediaServerSubList();null!==e?o.j.error(e.message):o.j.success("刷新成功")}))};return(e,t)=>{const l=(0,a.up)("q-spinner-hourglass"),n=(0,a.up)("q-btn");return(0,i.SU)(s)?((0,a.wg)(),(0,a.j4)(n,{key:0,label:"更新媒体服务器字幕",color:"primary",icon:"cached",onClick:r},{loading:(0,a.w5)((()=>[(0,a.Wm)(l,{class:"on-left"}),(0,a.Uk)(" 更新缓存中... ")])),_:1})):(0,a.kq)("",!0)}}};var p=s(2165),c=s(3282),d=s(7518),v=s.n(d);const m=r,h=m;v()(r,"components",{QBtn:p.Z,QSpinnerHourglass:c.Z})},2798:(e,t,s)=>{s.d(t,{Z:()=>y});var a=s(3673),i=s(8880),l=s(1959),n=s(4739),o=s(7493),u=s(9897),r=s(5936);const p={key:0,class:"row items-center q-gutter-xs"},c={key:0,style:{"font-size":"90%"}},d={__name:"BtnUploadSubtitle",props:{path:String,dense:{type:Boolean,default:!1}},setup(e){const t=e,s=(0,l.iH)(null),d=(0,l.iH)(null),v=(0,l.iH)(!1);(0,a.m0)((()=>{v.value=n.FC.value.some((e=>e.video_f_path===t.path))}));const m=()=>{d.value.$el.click()},h=async()=>{const e=new FormData;e.append("video_f_path",t.path),e.append("file",s.value[0]),v.value=!0,await o.Z.uploadSubtitle(e),u.j.success("字幕上传成功。如果设置开启了“自动校正时间轴”，处理需要一些时间，请耐心等待",{timeout:3e3}),await(0,n.Dr)(),r.Z.emit("subtitle-uploaded")};return(0,a.YP)(s,(()=>{h()})),(t,l)=>{const n=(0,a.up)("q-spinner-hourglass"),o=(0,a.up)("q-btn"),u=(0,a.up)("q-input");return(0,a.wg)(),(0,a.iD)(a.HY,null,[v.value?((0,a.wg)(),(0,a.iD)("div",p,[(0,a.Wm)(n,{color:"primary",size:"22px"}),e.dense?(0,a.kq)("",!0):((0,a.wg)(),(0,a.iD)("div",c,"字幕上传中"))])):((0,a.wg)(),(0,a.j4)(o,(0,a.dG)({key:1,color:"primary",flat:"",dense:"",icon:"upload"},t.$attrs,{label:e.dense?"":"上传本地字幕",onClick:m,title:"上传本地字幕"}),null,16,["label"])),(0,a.wy)((0,a.Wm)(u,{type:"file",ref_key:"qFile",ref:d,modelValue:s.value,"onUpdate:modelValue":l[0]||(l[0]=e=>s.value=e),accept:".srt,.ass,.ssa,.sbv,.webvtt"},null,8,["modelValue"]),[[i.F8,!1]])],64)}}};var v=s(3282),m=s(2165),h=s(4842),g=s(7518),_=s.n(g);const w=d,y=w;_()(d,"components",{QSpinnerHourglass:v.Z,QBtn:m.Z,QInput:h.Z})},8423:(e,t,s)=>{s.d(t,{Z:()=>R});var a=s(3673),i=s(2323),l=s(1959),n=s(7493),o=s(9897),u=s(8486),r=s(9608),p=s(4739),c=s(5936),d=s(8825),v=s(4764),m=s(1315),h=s(2170),g=s(768),_=s(5355),w=s(1465),y=s(1684);const b={style:{"min-height":"300px"}},f={class:"row items-center q-gutter-sm"},k={class:"row"},S={key:2,class:"text-grey"},Z={key:0,class:"q-ml-md text-negative"},q={class:"text-negative"},T={class:"text-negative"},D=(0,a._)("div",null,[(0,a.Uk)("如果报错信息提示没有 ApiKey，请到"),(0,a._)("b",null,"配置中心-字幕源设置"),(0,a.Uk)("，填写SubtitleBest的ApiKey")],-1),x={key:0},U={__name:"SearchPanelCsfApi",props:{path:String,isMovie:{type:Boolean,default:!1},season:{type:Number},episode:{type:Number},hideDownload:{type:Boolean,default:!1},hideLimit:{type:Boolean,default:!1},useUserShareApi:{type:Boolean,default:!1}},emits:["getResult"],setup(e,{emit:t}){const s=e,U=(0,d.Z)(),{nextRequestCountdownSecond:H,countdownLoading:j,waitRequestReady:P}=(0,_.R)("lastSubtitleBestRequestTime",5e3),B=(0,l.iH)(""),I=(0,l.iH)(""),W=(0,l.iH)(!1),C=(0,l.iH)(""),Q=(0,l.iH)(null),O=(0,l.iH)(null),L=(0,l.iH)(null),R=(0,l.iH)(null),z=(0,a.Fl)((()=>s.useUserShareApi?y.Z:u.Z)),A=(0,l.iH)({}),M=(0,a.Fl)((()=>O.value?URL.createObjectURL(O.value):null)),K=async()=>{const[,e]=await n.Z.setSkipInfo({video_skip_infos:[{video_type:s.isMovie?m.b2:m.EH,physical_video_file_full_path:s.path,is_bluray:!1,is_skip:!0}]});null!==e?o.j.error(e.message):(c.Z.emit(`refresh-skip-status-${s.path}`,!0),o.j.success("操作成功"))},V=async()=>{W.value=!0,I.value="",C.value="正在从TMDB获取视频详细信息...";const[e,a]=await n.Z.getImdbId({is_movie:s.isMovie,video_f_path:s.path});if(a)return h.K.settings.advanced_settings.tmdb_api_settings.enable?B.value="从 TMDB 获取数据失败，检测到你当前正在使用自己的 TMDB ApiKey ，请检查进阶设置-TMDB API中设置的ApiKey是否有效。":B.value="从 TMDB 获取数据失败，检测到你正在使用公共查询接口，可能是使用人数过多导致查询失败，可以尝试在进阶设置里启用 TMDB API，填写自己的 ApiKey。",W.value=!1,C.value="",void o.j.error(a.message);if(B.value="",C.value="正在从 SubtitleBest 获取字幕列表...",R.value=e?.ImdbId,!(0,w.fE)(R.value))return C.value="",void(W.value=!1);if(s.isMovie){const[e,t]=await z.value.searchMovie({imdb_id:R.value});null!==t?(I.value=t.message,o.j.error(t.message)):Q.value=e.subtitles}else{const[e,t]=await z.value.searchTvEps({imdb_id:R.value,season:s.season,episode:s.episode});null!==t?(I.value=t.message,o.j.error(t.message)):Q.value=e.subtitles}t("getResult",Q.value),C.value="",W.value=!1},$=async e=>{if(L.value=e,A.value[e.sub_sha256])return void(O.value=A.value[e.sub_sha256]);O.value=null,W.value=!0,C.value="正在获取下载地址...",await P(),C.value="正在下载字幕...";const[t,s]=await z.value.getDownloadUrl({...e,imdb_id:R.value});if(null!==s)o.j.error(s.message);else{const s=await fetch(t.download_link),a=await s.blob();A.value={...A.value,[e.sub_sha256]:a},O.value=a}C.value="",W.value=!1},F=async e=>{if(await $(e),!O.value)return;const t=new FormData;t.append("video_f_path",s.path),t.append("file",new File([O.value],e.title,{type:"text/plain"})),await n.Z.uploadSubtitle(t),await(0,p.Dr)(),c.Z.emit("subtitle-uploaded"),U.dialog({title:"操作确认",message:"已下载到库中，是否锁定该视频，无需再次自动下载字幕？",cancel:!0,persistent:!0,focus:"none"}).onOk((async()=>{K()})),o.j.success("已下载到库中")},Y=async(e,t)=>{await $(e),M.value?t(!0):t(!1)};return(0,a.bv)((()=>{V()})),(t,s)=>{const n=(0,a.up)("q-badge"),o=(0,a.up)("q-item-section"),u=(0,a.up)("q-btn"),p=(0,a.up)("q-item"),c=(0,a.up)("q-list"),d=(0,a.up)("q-spinner"),m=(0,a.up)("q-inner-loading");return(0,a.wg)(),(0,a.iD)("div",b,[e.hideLimit?(0,a.kq)("",!0):((0,a.wg)(),(0,a.j4)(g.Z,{key:0})),Q.value?.length?((0,a.wg)(),(0,a.j4)(c,{key:1,separator:""},{default:(0,a.w5)((()=>[((0,a.wg)(!0),(0,a.iD)(a.HY,null,(0,a.Ko)(Q.value,((t,s)=>((0,a.wg)(),(0,a.j4)(p,{key:t.sub_sha256},{default:(0,a.w5)((()=>[(0,a.Wm)(o,null,{default:(0,a.w5)((()=>[(0,a._)("div",f,[(0,a._)("div",null,(0,i.zw)(s+1)+". "+(0,i.zw)(t.title),1),(0,a.Wm)(n,{color:"primary"},{default:(0,a.w5)((()=>[(0,a.Uk)((0,i.zw)((0,l.SU)(v.a)[t.language]),1)])),_:2},1024),A.value[t.sub_sha256]?((0,a.wg)(),(0,a.j4)(n,{key:0,color:"grey",title:"已缓存到浏览器，再次预览和下载不消耗次数，关闭窗口后失效"},{default:(0,a.w5)((()=>[(0,a.Uk)("已缓存")])),_:1})):(0,a.kq)("",!0)])])),_:2},1024),(0,a.Wm)(o,{side:""},{default:(0,a.w5)((()=>[(0,a._)("div",k,[(0,a.Wm)(r.Z,{path:e.path,"subtitle-url-list":[(0,l.SU)(M)],"on-btn-click":e=>Y(t,e),"subtitle-type":L.value?.ext.replace(".","")},null,8,["path","subtitle-url-list","on-btn-click","subtitle-type"]),e.hideDownload?(0,a.kq)("",!0):((0,a.wg)(),(0,a.j4)(u,{key:0,color:"primary",icon:"download",flat:"",dense:"",onClick:e=>F(t),title:"下载"},null,8,["onClick"]))])])),_:2},1024)])),_:2},1024)))),128))])),_:1})):W.value?(0,a.kq)("",!0):((0,a.wg)(),(0,a.iD)("div",S,[(0,a._)("div",null,[(0,a._)("span",null,"ImdbId: "+(0,i.zw)(R.value||"-"),1),R.value&&!(0,l.SU)(w.fE)(R.value)?((0,a.wg)(),(0,a.iD)("span",Z,"这是个无效的ImdbId")):(0,a.kq)("",!0)]),B.value?((0,a.wg)(),(0,a.iD)(a.HY,{key:0},[(0,a._)("div",q,(0,i.zw)(B.value),1),(0,a._)("div",null,[(0,a.Wm)(u,{flat:"",label:"重试",color:"primary",dense:"",onClick:V})])],64)):I.value?((0,a.wg)(),(0,a.iD)(a.HY,{key:1},[(0,a._)("div",T,"获取字幕列表失败，错误信息："+(0,i.zw)(I.value),1),(0,a._)("div",null,[(0,a.Wm)(u,{flat:"",label:"重试",color:"primary",dense:"",onClick:V})])],64)):((0,a.wg)(),(0,a.iD)(a.HY,{key:2},[(0,a._)("div",null,[(0,a.Uk)("未搜索到数据，"),(0,a.Wm)(u,{flat:"",label:"重试",color:"primary",dense:"",onClick:V})]),D],64))])),(0,a.Wm)(m,{showing:W.value},{default:(0,a.w5)((()=>[(0,a.Wm)(d,{size:"50px",color:"primary"}),(0,a._)("div",null,(0,i.zw)(C.value),1),(0,l.SU)(j)?((0,a.wg)(),(0,a.iD)("div",x,"预计 "+(0,i.zw)((0,l.SU)(H))+" 秒后取得数据",1)):(0,a.kq)("",!0)])),_:1},8,["showing"])])}}};var H=s(7011),j=s(3414),P=s(2035),B=s(9721),I=s(2165),W=s(6941),C=s(9400),Q=s(7518),O=s.n(Q);const L=U,R=L;O()(U,"components",{QList:H.Z,QItem:j.Z,QItemSection:P.Z,QBadge:B.Z,QBtn:I.Z,QInnerLoading:W.Z,QSpinner:C.Z})},3280:(e,t,s)=>{s.d(t,{Z:()=>$});var a=s(3673),i=s(1959),l=s(2323),n=s(7493),o=s(9897),u=s(8486),r=s(9608),p=s(4739),c=s(5936),d=s(8825),v=s(4764),m=s(1315),h=s(2170),g=s(768),_=s(5355),w=s(1465),y=s(1684);const b=(0,a._)("div",{class:"q-px-md text-bold"},"字幕包列表",-1),f={class:"q-px-md row justify-between"},k=(0,a._)("div",{class:"text-bold"},"字幕列表",-1),S={class:"row items-center q-gutter-sm"},Z={key:0,class:"row"},q={key:1,class:"text-grey"},T={key:1,class:"text-grey q-pa-md"},D={key:2,class:"text-grey"},x={key:0,class:"q-ml-md text-negative"},U={class:"text-negative"},H={class:"text-negative"},j=(0,a._)("div",null,[(0,a.Uk)("如果报错信息提示没有 ApiKey，请到"),(0,a._)("b",null,"配置中心-字幕源设置"),(0,a.Uk)("，填写SubtitleBest的ApiKey")],-1),P={key:0,class:"text-bold"},B={key:1},I={__name:"SearchPanelCsfApiTvPackage",props:{episodes:Array,hideDownload:{type:Boolean,default:!1},hideLimit:{type:Boolean,default:!1},useUserShareApi:{type:Boolean,default:!1}},emits:["getResult"],setup(e,{emit:t}){const s=e,I=(0,d.Z)(),{nextRequestCountdownSecond:W,countdownLoading:C,waitRequestReady:Q}=(0,_.R)("lastSubtitleBestRequestTime",5e3),O=(0,i.iH)(300),L=(0,i.iH)(""),R=(0,i.iH)(""),z=(0,i.iH)([]),A=(0,i.iH)(null),M=(0,i.iH)(!1),K=(0,i.iH)(!1),V=(0,i.iH)(""),$=(0,i.iH)(null),F=(0,i.iH)(null),Y=(0,i.iH)(null),E=(0,i.iH)(null),G=(0,a.Fl)((()=>s.useUserShareApi?y.Z:u.Z)),N=(0,a.Fl)((()=>s.episodes[0]?.video_f_path)),J=(0,a.Fl)((()=>s.episodes[0]?.season)),X=(0,i.iH)({}),ee=(0,i.iH)({}),te=(0,a.Fl)((()=>$?.value.filter((e=>e.sub_sha256===ee.value[e.episode])).length||0)),se=(0,a.Fl)((()=>F.value?URL.createObjectURL(F.value):null)),ae=async e=>{const[,t]=await n.Z.setSkipInfo({video_skip_infos:e.map((e=>({video_type:m.EH,physical_video_file_full_path:e,is_bluray:!1,is_skip:!0})))});null!==t?o.j.error(t.message):(e.forEach((e=>c.Z.emit(`refresh-skip-status-${e}`,!0))),o.j.success("操作成功"))},ie=async()=>{M.value=!0,R.value="",V.value="正在从TMDB获取视频详细信息...";const[e,s]=await n.Z.getImdbId({is_movie:!1,video_f_path:N.value});if(s)return h.K.settings.advanced_settings.tmdb_api_settings.enable?L.value="从 TMDB 获取数据失败，检测到你当前正在使用自己的 TMDB ApiKey ，请检查进阶设置-TMDB API中设置的ApiKey是否有效。":L.value="从 TMDB 获取数据失败，检测到你正在使用公共查询接口，可能是使用人数过多导致查询失败，可以尝试在进阶设置里启用 TMDB API，填写自己的 ApiKey。",M.value=!1,V.value="",void o.j.error(s.message);if(L.value="",V.value="正在从 SubtitleBest 获取字幕包列表...",E.value=e?.ImdbId,!(0,w.fE)(E.value))return V.value="",void(M.value=!1);const[a,i]=await G.value.searchTvSeasonPackage({imdb_id:E.value,season:J.value});null!==i?(o.j.error(i.message),R.value=i.message):z.value=a.season_package_ids,V.value="",M.value=!1,t("getResult",z.value)},le=async e=>{M.value=!0,V.value="正在获取字幕列表...";const[t,s]=await G.value.searchTvSeasonPackageId({imdb_id:E.value,season_package_id:e});null!==s?o.j.error(s.message):$.value=t.subtitles,V.value="",M.value=!1};(0,a.YP)((()=>A.value),(e=>{e&&le(e)}));const ne=async e=>{if(Y.value=e,X.value[e.sub_sha256])return void(F.value=X.value[e.sub_sha256]);F.value=null,M.value=!0,V.value="正在获取下载地址...",await Q(),V.value="正在下载字幕...";const[t,s]=await G.value.getDownloadUrl({...e,imdb_id:E.value});if(null!==s)o.j.error(s.message);else{const s=await fetch(t.download_link),a=await s.blob();X.value={...X.value,[e.sub_sha256]:a},F.value=a}V.value="",M.value=!1},oe=e=>s.episodes.find((t=>t.episode===e.episode))?.video_f_path,ue=async(e,t=!1,s=!1)=>{if(await ne(e),!F.value)return;const a=oe(e),i=new FormData;i.append("video_f_path",a),i.append("file",new File([F.value],e.title,{type:"text/plain"})),await n.Z.uploadSubtitle(i),await(0,p.Dr)(),c.Z.emit("subtitle-uploaded"),t&&I.dialog({title:"操作确认",message:"已下载到库中，是否锁定该视频，无需再次自动下载字幕？",cancel:!0,persistent:!0,focus:"none"}).onOk((async()=>{ae([a])})),ee.value[e.episode]=e.sub_sha256,s&&o.j.success("已下载到库中")},re=async(e,t)=>{await ne(e),se.value?t(!0):t(!1)},pe=async()=>{if(0!==$.value.length){K.value=!0;try{for(const e of $.value)s.episodes.some((t=>t.episode===e.episode))&&await ue(e,!1,!1);I.dialog({title:"操作确认",message:"已下载到库中，是否锁定本季视频，无需再次自动下载字幕？",cancel:!0,persistent:!0,focus:"none"}).onOk((async()=>{ae(s.episodes.map((e=>e.video_f_path)))}))}catch(e){o.j.error(e)}K.value=!1}else o.j.warning("没有可下载的字幕")};return(0,a.bv)((()=>{ie()})),(t,s)=>{const n=(0,a.up)("q-item-section"),o=(0,a.up)("q-item"),u=(0,a.up)("q-list"),p=(0,a.up)("q-btn"),c=(0,a.up)("q-badge"),d=(0,a.up)("q-splitter"),m=(0,a.up)("q-spinner"),h=(0,a.up)("q-inner-loading");return(0,a.wg)(),(0,a.iD)("div",{key:(0,i.SU)(N),style:{"min-height":"300px"}},[e.hideLimit?(0,a.kq)("",!0):((0,a.wg)(),(0,a.j4)(g.Z,{key:0})),z.value.length?((0,a.wg)(),(0,a.j4)(d,{key:1,class:"q-mt-md overflow-hidden",modelValue:O.value,"onUpdate:modelValue":s[0]||(s[0]=e=>O.value=e),unit:"px"},{before:(0,a.w5)((()=>[b,(0,a.Wm)(u,null,{default:(0,a.w5)((()=>[((0,a.wg)(!0),(0,a.iD)(a.HY,null,(0,a.Ko)(z.value,((e,t)=>((0,a.wg)(),(0,a.j4)(o,{key:e,clickable:"",onClick:t=>A.value=e,active:A.value===e},{default:(0,a.w5)((()=>[(0,a.Wm)(n,{class:"overflow-hidden ellipsis no-wrap"},{default:(0,a.w5)((()=>[(0,a.Uk)((0,l.zw)(t+1)+". "+(0,l.zw)(e),1)])),_:2},1024)])),_:2},1032,["onClick","active"])))),128))])),_:1})])),after:(0,a.w5)((()=>[$.value?.length?((0,a.wg)(),(0,a.iD)(a.HY,{key:0},[(0,a._)("div",f,[k,e.hideDownload?(0,a.kq)("",!0):((0,a.wg)(),(0,a.j4)(p,{key:0,label:"下载全部",color:"primary",icon:"download",flat:"",onClick:pe}))]),(0,a.Wm)(u,{separator:""},{default:(0,a.w5)((()=>[((0,a.wg)(!0),(0,a.iD)(a.HY,null,(0,a.Ko)($.value,((t,s)=>((0,a.wg)(),(0,a.j4)(o,{key:t.sub_sha256},{default:(0,a.w5)((()=>[(0,a.Wm)(n,null,{default:(0,a.w5)((()=>[(0,a._)("div",S,[(0,a._)("div",null,(0,l.zw)(s+1)+". "+(0,l.zw)(t.title),1),(0,a.Wm)(c,{color:"primary"},{default:(0,a.w5)((()=>[(0,a.Uk)((0,l.zw)((0,i.SU)(v.a)[t.language]),1)])),_:2},1024),X.value[t.sub_sha256]?((0,a.wg)(),(0,a.j4)(c,{key:0,color:"grey",title:"已缓存到浏览器，再次预览和下载不消耗次数，关闭窗口后失效"},{default:(0,a.w5)((()=>[(0,a.Uk)("已缓存")])),_:1})):(0,a.kq)("",!0),ee.value[t.episode]===t.sub_sha256?((0,a.wg)(),(0,a.j4)(c,{key:1,color:"grey",title:"视频已下载该字幕"},{default:(0,a.w5)((()=>[(0,a.Uk)("已下载")])),_:1})):(0,a.kq)("",!0)])])),_:2},1024),(0,a.Wm)(n,{side:""},{default:(0,a.w5)((()=>[oe(t)?((0,a.wg)(),(0,a.iD)("div",Z,[(0,a.Wm)(r.Z,{disable:!oe(t),path:oe(t),"subtitle-url-list":[(0,i.SU)(se)],"on-btn-click":e=>re(t,e),"subtitle-type":Y.value?.ext.replace(".","")},null,8,["disable","path","subtitle-url-list","on-btn-click","subtitle-type"]),e.hideDownload?(0,a.kq)("",!0):((0,a.wg)(),(0,a.j4)(p,{key:0,color:"primary",icon:"download",flat:"",dense:"",onClick:e=>ue(t,!0,!0),title:"下载"},null,8,["onClick"]))])):((0,a.wg)(),(0,a.iD)("div",q,"找不到该字幕对应的视频"))])),_:2},1024)])),_:2},1024)))),128))])),_:1})],64)):((0,a.wg)(),(0,a.iD)("div",T,"请先选择字幕包"))])),_:1},8,["modelValue"])):M.value?(0,a.kq)("",!0):((0,a.wg)(),(0,a.iD)("div",D,[(0,a._)("div",null,[(0,a._)("span",null,"ImdbId: "+(0,l.zw)(E.value||"-"),1),E.value&&!(0,i.SU)(w.fE)(E.value)?((0,a.wg)(),(0,a.iD)("span",x,"这是个无效的ImdbId")):(0,a.kq)("",!0)]),L.value?((0,a.wg)(),(0,a.iD)(a.HY,{key:0},[(0,a._)("div",U,(0,l.zw)(L.value),1),(0,a._)("div",null,[(0,a.Wm)(p,{flat:"",label:"重试",color:"primary",dense:"",onClick:ie})])],64)):R.value?((0,a.wg)(),(0,a.iD)(a.HY,{key:1},[(0,a._)("div",H,"获取字幕列表失败，错误信息："+(0,l.zw)(R.value),1),(0,a._)("div",null,[(0,a.Wm)(p,{flat:"",label:"重试",color:"primary",dense:"",onClick:ie})])],64)):((0,a.wg)(),(0,a.iD)(a.HY,{key:2},[(0,a._)("div",null,[(0,a.Uk)("未搜索到数据，"),(0,a.Wm)(p,{flat:"",label:"重试",color:"primary",dense:"",onClick:ie})]),j],64))])),(0,a.Wm)(h,{showing:M.value||K.value},{default:(0,a.w5)((()=>[(0,a.Wm)(m,{size:"50px",color:"primary"}),K.value?((0,a.wg)(),(0,a.iD)("div",P,"("+(0,l.zw)((0,i.SU)(te))+" / "+(0,l.zw)(e.episodes.length)+")",1)):(0,a.kq)("",!0),(0,a._)("div",null,(0,l.zw)(V.value),1),(0,i.SU)(C)?((0,a.wg)(),(0,a.iD)("div",B,"预计 "+(0,l.zw)((0,i.SU)(W))+" 秒后取得数据",1)):(0,a.kq)("",!0)])),_:1},8,["showing"])])}}};var W=s(218),C=s(7011),Q=s(3414),O=s(2035),L=s(2165),R=s(9721),z=s(6941),A=s(9400),M=s(7518),K=s.n(M);const V=I,$=V;K()(I,"components",{QSplitter:W.Z,QList:C.Z,QItem:Q.Z,QItemSection:O.Z,QBtn:L.Z,QBadge:R.Z,QInnerLoading:z.Z,QSpinner:A.Z})}}]);